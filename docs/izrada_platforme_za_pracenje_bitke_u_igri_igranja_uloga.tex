\documentclass{foi}
\usepackage[utf8]{inputenc}
\usepackage{lipsum}

\vrstaRada{\diplomski} % \diplomski
\title{Izrada platforme za praćenje bitke u igri igranja uloga}

\author{Hrvoje Lesar}
\spolStudenta{\musko} % \zensko ili \musko
\mentor{Markus Schatten}
\spolMentora{\musko} % \zensko ili \musko
\godina{2025}
\mjesec{rujan}
\date{2025}
%\status{redoviti}
\indeks{0016133479}
\smjer{Organizacija poslovnih sustava} % (ili Poslovni sustavi, Ekonomika poduzetništva, Primjena informacijske tehnologije u poslovanju, Informacijsko i programsko inženjerstvo, Baze podataka i baze znanja, Organizacija poslovnih sustava, Informatika u obrazovanju)
\titulaProfesora{Prof. dr. sc.}

\sazetak{Opsega od 100 do 300 riječi. Sažetak upućuje na temu rada, ukratko se iznosi čime se rad bavi, teorijsko-metodološka polazišta, glavne teze i smjer rada te zaključci.}

\kljucneRijeci{riječ; riječ; ...riječ; Obuhvaća 7+/-2 ključna pojma koji su glavni predmet rasprave u radu.}

\begin{document}

\maketitle

\tableofcontents

\pagestyle{plain}

\chapter{Uvod}
\label{chapter:uvod}

\begin{itemize}
    \item Rpg
    \item Cilj
    \item Prvi dio...
    \item Praktični dio
\end{itemize}

\chapter{Igre igranja uloga}
\label{chapter:igra-igranja-uloga}

Igre igranja uloga predstavljaju jedan od najsloženijih i kreativnih spojeva
priče, izvedbe i igre u suvremenoj kulturi. 
Ovakva igra poziva igrače da zajednički stvaraju i nastanjuju zamišljeni svijet,        
vođeni kombinacijom strukturiranih pravila i spontanog pripovijedanja.
Svaka sesija je istovremeno i igra i priča, a njezin ishod oblikuju
mašta igrača i slučajnost ishoda bacanja kockica.

Igre igranja uloga nemaju jednu definiciju i možemo ih definirati s različitih gledišta:
\begin{itemize}
    \item Situacija igranja uloga definirana kao situacija u kojoj se od pojedinca izričito traži da preuzme
        ulogu koja inače nije njegova, ili ako jest njegova, onda u okruženju koje nije
        uobičajeno za izvođenje te uloge. \cite{mann1956experimental}
    \item Igranje uloga nije jedinstvena jasno definirana aktivnost, već čitav niz aktivnosti
        okupljenih pod pogodnim nazivom. Na jednom kraju spektra nalazi se intenzivno odražavanje
        osobnih emocija, dok se na drugom kraju nalazi situacija u kojoj je preuzimanje uloge
        bliže konceptu zagovaranja. \cite{white2024tabletop}
    \item Igranje uloga je umjetnost iskustva, a stvaranje igranja uloga znači kreiranje novih iskustava. \cite{white2024tabletop}
    \item Igranje uloga definira se kao bilo koji čin u kojem se istovremeno stvara, dodaje i promatra imaginarna stvarnost. \cite{white2024tabletop}
    \item Igra igranja uloga mora se sastojati od interaktivnog pripovijedanja: 
        sposobnosti likova i razrješenja radnji, definirani su brojevima ili količinama kojima se
        manipulira prema određenim pravilima. Donošenje odluka igrača pokreće i pomiče priču unaprijed.
        Uz skupinu koja djeluje kao autor, priča organski raste i odigrava se, bivajući doživljena
        od svojih stvaratelja. \cite{white2024tabletop}
\end{itemize}

\section{Ratne igre}
\label{section:ratne-igre}

Početak i inspiracija za igre igranja uloga dolazi iz ratnih igara.
Nasljeđe ratnih igara seže od šaha, budući da su prve igre unutar posebne
kategorije ratnih igara uvelike posuđivale ploče, figure i mehanike upravo
iz šaha. Georg von Rei{\ss}witz se smarta ocem ratnih igara, jer je razvio
prvi sustav ratnih igara koji je široko korišten kao ozbiljan alat za obuku
i istraživanje. Razvijenu igru su nazvali tzv. \texttt{Das Kriegsspiel} te je igra
zadovoljila dugo prepoznatu potrebu za jeftinim i lako ponovljivim sredstvom
za obuku časnika u zapovijedanju i planiranju bitke. Vojne ratne igre gotovo se uvijek
fokusiranju na sadašnjost, na ondašnje vojske, tehnologiju i države u vrijeme
njihova nastanka. Veliki dio razvoja ratnih igara osamnaestog
i devetnaestog stoljeća održava neprestana poboljšanja u sredstvima i 
provedbi ratovanja te posljedičnu potrebu da se ratne igre stalno usklađuju s
realnošću. \cite{peterson2012playing}

Tek kad su se hobisti počeli poigravati ovim sustavima, uspjeli su osloboditi
ratne igre ograničenja suvremenog konteksta i istražiti povijesna razdoblja,
buduće moguće svjetove, pa čak i nemoguće fantastične svjetove.
Hobisti su također odbacili strogo reproduciranje stvarnih uvjeta na
bojištu u korist više uravnoteženijeg pristupa koji je kombinirao
realističnost i igrivost. Do 1960-ih, ovi zaigrani ljubitelji ratnih igara
transformirali su ih iz sredstva za vojnu obuku u znatno maštovitiju aktivnost,
onu koja je mogla poslužiti kao temelj za modeliranje događaja u igri
poput Dungeons \& Dragons (skraćeno D\&D). \cite{peterson2012playing}

\section{Nastanak sustava Dungeons \& Dragons}
\label{section:nastanak-sustava-dungeons-dragons}

Dungeons \& Dragons (kraće poznato kao D\&D), igra nastala 1974.
godine predstavlja ključni trenutak u povijesti igara uloga.
Igru su razvili Gary Gygax i Dave Arneson, koji su težili proširenju
mogućnosti stolnih ratnih igara prema novim narativnim i
imaginarnim domenama. Prije D\&D-a, Gygax je već imao utjecaj
u zajednici igranja ratnih igara (dalje u tekstu: wargaming), osobito kroz svoj rad na igri \texttt{Chainmail},
srednjovjekovnoj minijaturnoj ratnoj igri koju je razvio i bio jedan
od autora 1971. godine. 
\texttt{Chainmail} je izvorno zamišljen kao skup pravila za simulaciju
srednjovjekovnih bitaka s minijaturama, no uključivao je i fantastični dodatak
koji je omogućava igračima da u igru unesu mistična bića i čarobne elemente.
Ova dopuna održavala je Gygaxovu fascinaciju srednjovjekovnom literaturom i
fantastičnim narativima, posebno djelima J.R.R Tolkeina i 
Roberta E. Howarda. \cite{sidhu2024fifty}

Dave Arneson je eksperimentirao s narativnim pristupom u svojoj kampanji
Blackmoor, u kojoj su se pojedinačni likovi mogli razvijati kroz
više sesija i aktivno utjecati na tijek priče, za razliku od
tradicionalnog wargaminga u koje igrači kontroliraju cijele jedinice ili vojske.
Arnesonove inovacije, u kombinaciji s Gygaxovim strukturiranim sustavom pravila
iz Chainmaila, stvorile su temelje za mehaniku i narativni potencijal igre
D\&D. \cite{sidhu2024fifty}

Prvo izdanje D\&D-a je izdano 1974. godine. Bilo je u početku skromno 
po opsegu, no uvelo je revolucionarne koncepte;
igrači su mogli preuzeti uloge različitih likova istraživati fantastične tamnice,
sudjelovati u zadacima vođenim od strane Dungeon Mastera (DM-a),
koji moderira svijet igre.
Pravila D\&D-a uključivala su elemente minijaturnog wargaminga,
vjerojatnosnih mehanika s kockama i suradničkog pripovijedanja,
stvarajući novi oblik interaktivne zabave koji je spajao strategiju,
maštu i narativ. Tijekom vremena igra se razvila kroz više izdanja,
od kojih je svako unaprijedilo pravila i proširilo mogućnosti, no osnovni
princip suradničkog pripovijedanja i igre vođene likovima je ostao nepromijenjen.

\chapter{Opis pravila igre - Dungeons \& Dragons}
\label{chapter:opis-pravila-igre-dungeons-dragons}

Pravila igre D\&D razvila su se od početne koncepcije igre 70-tih godina 20. stoljeća.
Poglavlje će biti usredotočeno na pravila definirana u \texttt{Player's Handbook 2014}.
Svakim novim izdanjem igre pravila se suptilno nagorađuju, poboljšavaju i razvijaju te se 
dodaju nove mehanike igre. 

Dungeons \& Dragons je igra igranja uloga posvećena pripovijedanju u svjetovima
mača i čarolije. Dijeli elemente s dječjim igrama pretvaranja. Kao i te igre, D\&D pokreće
mašta. Radi se o zamišljanju visokog dvorca pod olujnim noćnim nebom i predočavanju kako bi
pustolov mogao reagirati na izazove koje taj prizor predstavlja.
Za razliku od igra pretvaranja, D\&D pričama daje strukturu, način određivanja posljedica
za akcije igrača. Igrači bacaju kockice kako bi razriješili jesu li njihovi napadi pogodili
ili promašili, ili mogu li se njihovi pustolovi popeti na liticu, izmaknuti se udaru čarobne munje
ili izvesti neki drugi opasan pothvat. Sve je moguće, ali kockice čine neke ishode vjerojatnijima
od drugih. \cite{playershandbook2014}

Jedan igrač preuzima ulogu Dungeon Mastera, glavnog pripovjedača i suca igre.
DM stvara pustolovine za likove, koji se kreću kroz njihove opasnosti i odlučuje koje
će putove istražiti. Više o DM-u će biti u potpoglavlju \ref{section:dungeon-master}.

Svaki igrač stvara pustolova (koji se naziva i likom) i udružuje se s drugim
pustolovima. Radeći zajedno, grupa može istraživati mračnu tamnicu, ukleti dvorac,
izgubljeni hram... Pustolovi mogu rješavati zagonetke, razgovarati s drugim
likovima, boriti se protiv čudovišta i otkrivati čudesne čarobne predmete i blago.

\section{Lista pojmova}
\label{section:lista-pojmova}

Ovo poglavlje služi za definiranje terminologije i kratica koje će se
koristiti kroz rad. Svaki termin će biti kraće opisan i potencijalno imati
engleski naziv (koji je uglavnom više prepoznatljiv nego hrvatski prijevod),
no cijeli kontekst ne mora biti razumljiv u spisu, već će biti opisan u nekom od sljedećih poglavlja.

\begin{itemize}
    \item \textbf{D\&D} Dungeons \& Dragons
    \item \textbf{DM} Dungeon Master
    \item \textbf{NPC} Non-Player Character
    \item \textbf{D20} Kockica s dvadeset strana
    \item \textbf{D2, D4, D6, D8, D10, D12} Kockice s određenim brojem strana
    \item \textbf{AC} Armour class, klasa oklopa
    \item \textbf{DC} Difficulty class, težina zadatka
    \item \textbf{HP} Hit points, životni bodovi
    \item \textbf{XP} Experience points, bodovi iskustva
    \item \textbf{Ability score} Sposobnosti, rezultat sposobnosti
    \item \textbf{Hit die} Kockica za životne bodove
\end{itemize}

\section{Dungeon Master}
\label{section:dungeon-master}

Dungeon master je kreativna sila iza D\&D sesije. DM stvara svijet koji ostali igrači
istražuju te također osmišljava i vodi pustolovine koje pokreću priču.
Pustolovina se obično temelji na uspješnom dovršetku neke potrage i može trajati
kratko poput jedne sesije ili se protezati kroz više sesija.
Duže pustolovine mogu uvući igrače u velike sukobe za čije je rješavanje potrebno
više sesija. Kada se povežu u niz pustolovine čine trajnu priču nazvanu kampanja.
D\&D kampanja može uključivati desetke pustolovina i trajati jednu sesiju, mjesecima ili
pa ćak i godinama. \cite{dungeonmastersguide2014}

Dungeon master preuzima mnogo različitih uloga. Kao arhitekt kampanje, DM stvara pustolovine
postavljajući pozicije čudovišta, zamka i blaga koje likovi drugih igrača mogu otkriti.
Kao pripovjedač, DM pomaže ostalim igračima vizualizirati što se događa oko njih,
improvizirajući kada pustolovi učine nešto ili odu negdje neočekivano. Kao glumac, DM
igra uloge čudovišta i sporednih likova, time im daje život.
A kao sudac, DM tumači pravila i odlučuje kada ih se treba pridržavati, a kada ih promijeniti.
Svaki DM pristupa ulogama izmišljanja, pisanju, pripovijedanju, improvizaciji, glumi i suđenju
drugačije i vjerojatno će igrači i sam DM u nekim uživati više nego u drugima.

D\&D pravila pomažu DM-u i ostalim igračima da se dobro zabave, ali pravila nisu glavni autoritet.
DM je glavni i upravlja igrom te smije "kršiti" ili mijenjati definirana pravila. 
Ipak, cilj DM-a nije pobiti pustolove, već stvoriti svijet kampanje koji se vrti oko njihovih
djela i odluka te osigurati da se igrači vraćaju po još.

Uspjeh D\&D sesije ovisi o sposobnosti DM-a da zabavi ostale igrače za stolom,
dok je njihova uloga stvaranje likova, udahnuti im život i pomoći usmjeravati kampanju
kroz postupke svojih likova. DM treba održati igrače (i sebe) zainteresiranima i uživljenima
u svijet koji je stvorio te omogućiti njihovim likovima da čine nevjerojatne stvari.
Poznavanje u kojim dijelovima D\&D-a igrači najviše uživaju pomaže DM-u stvoriti i voditi
avanture u kojima će uživati i kojih će se sjećati. \cite{dungeonmastersguide2014}

Aktivnosti na koje se DM može fokusirati za bolje zadovoljstvo igrača \cite{dungeonmastersguide2014}:
\begin{itemize}
    \item Gluma; igrači koji uživaju u glumi vole ulaziti u ulogu svog lika i govoriti njihovim glasom.
        Kao igrači uloge u duši, oni uživaju u društvenim interakcijama s NPC-ovima, čudovištima i ostalim
        članovima družine.
    \item Istraživanje; igrači koji žude za istraživanjem žele iskusiti čuda koja nudi fantastični svijet.
        Žele znati što se nalazi iza sljedećeg ugla ili brda, također vole pronalaziti skrivene tragove i blago.
    \item Poticanje akcije; neki igrači vole poticati akciju, željni su da se stvari događaju čak
        i ako to znači preuzimanje opasnih rizika. Rađe će srljati u opasnost i suočiti se s posljedicama
        nego se suočiti s dosadom.
    \item Borba; drugi igrači uživaju u fantastičnoj borbi poput premlaćivanja zlikovaca i čudovišta.
        Traže bilo kakav izgovor da započne borba, preferirajući akciju nad pažljivim promišljanjem.
    \item Optimizacija lika; igrači koji uživaju u optimizaciji sposobnosti svojih likova vole
        podešavati svoje likove za vrhunske borbene performanse stjecanjem razina, novih značajki i
        čarobnih predmeta, rado će prihvatiti svaku priliku da pokažu nadmoć svojih likova.
    \item Rješavanje problema; igrači koji žele rješavati probleme vole proučavati motivacije
        drugih likova, razmrsiti spletke zlikovaca, rješavati zagonetke i smišljati planove.
    \item Pripovijedanje; igrači koji vole pripovijedanje žele doprinijeti priči. Sviđa im se kada su njihovi
        likovi uključeni u priču koja se razvija i uživaju u susretima koji su vezani s
        glavnom radnjom i proširuju je.
\end{itemize}

\section{Sustav D20}
\label{section:sustav-d20}

Kockica s dvadeset strana najčešće je korištena za određivanje uspjeha ili neuspjeha
radnji u D\&D-u i tu kockicu nazivom D20. Ponekad se koriste 
dvanaesterostrane, osmerostrane, šesterostrane, četverostrane kockice i novčić, one također imaju nazive
ovisno o broju strana, D12, D10, D8, D6, D4 i D2.

Svi likovi i čudovišta u igri definirani su kroz šest osnovnih sposobnosti: 
snaga (engl. \textit{strength}),
spretnost (engl. \textit{dexterity}),
izdržljivost (engl. \textit{constitution}),
inteligencija (engl. \textit{intelligence}),
mudrost (engl. \textit{wisdom})
i karizma (engl. \textit{charisma}).
Kod većine pustolova vrijednosti tih sposobnosti kreću se od 3 do 18,
dok kod čudovišta mogu biti niske poput 1 ili visoke do 30. 
Te vrijednosti, kao i modifikatori koji iz njih proizlaze, temelj su gotovo
svakog bacanja D20 kockice

Tri glavne vrste bacanja čine srž pravila igre: provjera sposobnosti,
bacanje za napad i bacanje za spas (engl. \textit{saving throw}). Sve tri radnje slijede nekoliko koraka:
\begin{enumerate}
    \item bacanje kockice i dodavanje modifikatora. Na rezultat bačene D20 kockice dodajemo odgovarajući modifikator.
    Najčešće je to modifikator jedne od šest sposobnosti, a ponekad uključuje i bonus stručnosti koji
    odražava specifičnu vještinu lika.
    \item uračunavanje dodatnih bonusa i kazni. Značajke klase, čarolije, specifične okolnosti ili neki drugi
    efekti mogu dodati bonus na rezultat ili ga umanjiti.
    \item usporedba rezultata s ciljanim brojem. Ako je ukupan zbroj jednak ili veći od ciljnog broja, radnja
    (provjera, napad, spašavanje) je uspješna, u suprotnom, nije uspjela. DM obično određuje ciljne brojeve
    i govori igračima jesi li uspjeli odraditi radnju. DM ne treba otkriti igračima ciljani broj za uspjeh.
\end{enumerate}

Ciljni broj za provjere sposobnosti i spas naziva se težina zadatka ili difficulty class (DC), dok se ciljni
broj za napad naziva klasa oklopa ili Armour Class (AC). Ovo jednostavno pravilo temelj je 
rješavanja većine situacija u D\&D-u.

Kod nekih provjera sposobnosti, bacanja za napad ili bacanja za spas bacanje kockice se modificira
posebnom situacijom koju nazivamo prednost (engl. \textit{advantage}) ili odsutnost prednosti (engl. \textit{disadvantage}).
U ovoj situaciji kod bacanja D20 kockice, baca se dodatna D20 i ovisno o situaciji, ako je prednost ili odsutnost prednosti
odabire se kockica s najvećom vrijednošću ili kockica s najmanjom vrijednošću.

\section{Kreacija lika}
\label{section:kreacija-lika}

Kreiranje lika predstavlja odabir rase i klase te ostalih pojedinosti 
koje likovi time dobivaju kao i postupak kojim se dobivaju početne sposobnosti lika.
Na slikama ispod nalaze se primjeri stranica o karakteristikama lika (engl. \textit{character sheet}).
Character sheet koristi igračima za zapisivanje i praćenje karakteristika
njihovih likova.

Character sheet se sastoji od tri stranice, prva stranica (Slika \ref{fig:character-sheet-p1})
sadrži podatke o sposobnostima lika, njegovu klasu, rasu, vještine, trenutnu opremu, životne
bodove.
Druga stranica (Slika \ref{fig:character-sheet-p2})
ima podatke o izgledu lika, starosti, visini, pozadinskoj priči, blagu.
Omogućuje igraču detaljan opis svog lika, lakše preuzimanje uloge lika
i gledanje fantastičnog svijeta kroz oči lika.
Dok treća stranica (Slika \ref{fig:character-sheet-p3})
sadrži podatke o čarolijama pripremljenim i znanim čarolijama te razinama (engl. \textit{levels})
i broj čarolija koje lik može baciti prije potrebnog odmora.

\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{slike/character_sheet_p1.jpg}
    \caption{Character sheet - Prva stranica \cite{charactersheet2014}}
    \label{fig:character-sheet-p1}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{slike/character_sheet_p2.jpg}
    \caption{Character sheet - Druga stranica \cite{charactersheet2014}}
    \label{fig:character-sheet-p2}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{slike/character_sheet_p3.jpg}
    \caption{Character sheet - Treća stranica \cite{charactersheet2014}}
    \label{fig:character-sheet-p3}
\end{figure}

% \begin{figure}[!htb]
%     \centering
%     \includegraphics[width=0.9\textwidth]{slike/character_sheet_p1.jpg}
%     \caption{Character sheet \cite{charactershet2014}}
%     \label{fig:character-sheet}
% \end{figure}

\subsection{Rase}
\label{section:rase}

Svaki lik pripada rasi, jednoj od mnogih rasa dostupnih u D\&D-u.
Najčešće rase likova su patuljci, vilenjaci i ljudi.
Neke rase također imaju podrase, kao što su planinski patuljci ili
šumski vilenjaci.
Odabrana rasa doprinosi identitetu lika, uspostavlja opći izgled,
pruža prirodne talente stečene kulturom i precima.
Rasa daje određene rasne osobine, kao što su posebna osjetila, vještine
s određenim oružjem ili alatima, stručnost u jednoj ili više vještina ili 
sposobnost korištenja manjih čarolija. Ove osobine se ponekad podudaraju
i nadopunjuju sposobnostima određenih klasa.
Najčešće rasne osobine su uvećanje jedne ili više sposobnosti,
dob lika, moralni kompas, veličina, brzina, jezici koje lik razumije
i kojima se može služiti i razgovarati te podrase; članovi podrase imaju
osobine matične rase uz dodatne osobine definirane podrasom.

U nastavku će biti definirane različite rase, njihove podrase, dob,
veličina, brzina i ostale sposobnosti koje se dobivaju odabirom pojedine rase. 
Kao primjer će za patuljke biti navedeni detaljni podaci o rasi, dok će druge rase
imati skraćene podatke, razumijevanje svih različitih rasnih osobina nije nužno
za implementaciju ni za razumijevanje igre:
\begin{itemize}
    \item Patuljak (engl. \textit{dwarf}) \cite{playershandbook2014}
        \begin{itemize}
            \item Povećanje sposobnosti: izdržljivost se povećava za 2.
            \item Dob: patuljci sazrijevaju istom brzinom kao i ljudi, ali se smatraju mladima do
                50. godine. Žive oko 350 godina.
            \item Veličina: Srednja, patuljci su visoki između 4 i 5 stopa.
            \item Brzina: brzina hoda je 25 stopa i ne smanjuje se nošenjem teškog oklopa
            \item Dodatna svojstva rase:
                \begin{itemize}
                    \item Vid u mraku (engl. \textit{darkvision}): patuljci vide u mraku i svijetlostno prigušenim uvjetima
                        do 60 stopa.
                    \item Patuljačka otpornost (engl. \textit{dwarven resilience}): prednost pri bacanju spasa protiv
                        otrova i otpornost na otrov.
                    \item Patuljačka borbena obuka (engl. \textit{dwarven combat training}): stručnost u korištenju bojne sjekire (engl. \textit{battleaxe}),
                        sjekirice (engl. \textit{handaxe}), lakog čekića (engl. \textit{throwing hammer}) i
                        ratnog čekića (engl. \textit{warhammer}).
                    \item Stručnost s alatom (engl. \textit{tool proficiency}): stručnost u korištenju jedne
                        vrsta alata: kovački alat, pivarski pribor, zidarski alat
                    \item Poznavanje kamena (engl. \textit{stonecunning}): na sve provjere inteligencije 
                        (vezane uz vještinu: povijest), dodaje se dvostruki bonus stručnosti na provjeru.
                \end{itemize}
            \item Jezici: patuljci govore, pišu i čitaju zajednički (engl. \textit{common}) i patuljački
            \item Podrase patuljaka: brdski patuljak; povećanje mudrosti za 1 i maksimalni
                broj životnih bodova povećava se za 1 po razini. Planinski patuljak; povećanje snage za 2 i
                stručnost s lakim i srednjim oklopom.
        \end{itemize}
    \item Vilenjak (engl. \textit{elf})
        \begin{itemize}
            \item Povećanje sposobnosti: spretnost se povećava za 2.
            \item Dob: vilenjaci sazrijevaju istom brzinom kao i ljudi, ali se smatraju odraslima
                tek oko 100. godine. Žive do 750 godina.
            \item Veličina: Srednja, vilenjaci su visoki od ispod 5 do preko 6 stopa.
            \item Brzina: brzina hoda je 30 stopa.
            \item Tri podrase: visoki vilenjak (engl. \textit{high elf}); 
                Šumski vilenjak (engl. \textit{wood elf}); 
                Tamni vilenjak (engl. \textit{drow}); 
        \end{itemize}

    \item Halfling
        \begin{itemize}
            \item Povećanje sposobnosti: spretnost se povećava za 2.
            \item Dob: halflinzi dosežu odraslu dob s 20 godina i žive do oko 150 godina.
            \item Veličina: Mala, halflinzi su visoki oko 3 stope.
            \item Brzina: brzina hoda je 25 stopa.
            \item Jezici: govore, pišu i čitaju zajednički i halflingški (engl. \textit{halfling}).
        \end{itemize}

    \item Čovjek (engl. \textit{human})
        \begin{itemize}
            \item Povećanje sposobnosti: sve sposobnosti se povećavaju za 1.
            \item Dob: ljudi dosežu odraslu dob u kasnim tinejdžerskim godinama i žive manje od stoljeća.
            \item Veličina: Srednja, ljudi znatno variraju u visini i građi.
            \item Brzina: brzina hoda je 30 stopa.
            \item Jezici: ljudi govore, pišu i čitaju zajednički i jedan dodatni jezik po izboru.
        \end{itemize}

    \item Dragonborn
        \begin{itemize}
            \item Povećanje sposobnosti: snaga se povećava za 2, a karizma za 1.
            \item Dob: brzo rastu, odrasli su s 15 godina i žive oko 80 godina.
            \item Veličina: Srednja, viši su i teži od ljudi, često preko 6 stopa.
            \item Brzina: brzina hoda je 30 stopa.
            \item Jezici: govore, pišu i čitaju zajednički i zmajski (engl. \textit{draconic}).
        \end{itemize}

    \item Gnom (engl. \textit{gnome})
        \begin{itemize}
            \item Povećanje sposobnosti: inteligencija se povećava za 2.
            \item Dob: gnomovi odrastaju oko 40. godine i žive 350 do 500 godina.
            \item Veličina: Mala, visoki su između 3 i 4 stope.
            \item Brzina: brzina hoda je 25 stopa.
            \item Jezici: gnomovi govore, pišu i čitaju zajednički  i gnomski (engl. \textit{gnomish}).
            \item Podvrste: šumski gnom (engl. \textit{forest gnome}) Kameni gnom (engl. \textit{rock gnome}).
        \end{itemize}

    \item Poluvilenjak (engl. \textit{half-elf})
        \begin{itemize}
            \item Povećanje sposobnosti: karizma se povećava za 2 i dvije druge sposobnosti po izboru za 1.
            \item Dob: sazrijevaju kao ljudi, odrasli s 20 godina, žive preko 180 godina.
            \item Veličina: Srednja, otprilike iste veličine kao ljudi.
            \item Brzina: brzina hoda je 30 stopa.
            \item Jezici: poluvilenjaci govore, pišu i čitaju zajednički, vilinski (engl. \textit{elvish}) 
                i jedan dodatni jezik po izboru.
        \end{itemize}

    \item Poluork (engl. \textit{half-orc})
        \begin{itemize}
            \item Povećanje sposobnosti: snaga se povećava za 2, a izdržljivost za 1.
            \item Dob: sazrijevaju brže od ljudi s oko 14 godina, žive do 75 godina.
            \item Veličina: Srednja, krupniji su od ljudi.
            \item Brzina: brzina hoda je 30 stopa.
            \item Jezici: poluorkovi govore, pišu i čitaju zajednički i orkovski (engl. \textit{orc}).
        \end{itemize}

    \item Tiefling
        \begin{itemize}
            \item Povećanje sposobnosti: inteligencija se povećava za 1, a karizma za 2.
            \item Dob: sazrijevaju kao ljudi, žive malo duže.
            \item Veličina: Srednja, iste veličine i građe kao ljudi.
            \item Brzina: brzina hoda je 30 stopa.
            \item Jezici: tieflinzi govore, pišu i čitaju zajednički i pakleni (engl. \textit{infernal}).
        \end{itemize}
\end{itemize}

\subsection{Klase}
\label{section:klase}

Klasa je temelj onoga što likovi mogu učiniti. Ona je više od pukog zanimanja;
ona je životni poziv lika. Klasa lika oblikuje način na koji igrači doživljavaju svijet
i kako s njim komuniciraju. Klasa daje raznoliko posebne značajke, poput borčeve vještine
s oružjem i oklopom ili magovim čarolijama. Na nižim razinama, klasa nudi tek dvije ili
tri značajke, no kako lik napreduje, stječe nove, a postojeće se često poboljšavaju 
\cite{playershandbook2014}.
U tablici ispod se nalaze nazivi klasa, opisi, kockice za životne bodove koje svaka klasa
koristi kod određivanja životnih bodova po razini, primarne sposobnosti klase,
sposobnosti koje se koriste kod bacanja za spas te stručnosti s oklopom i oružjem.
Osim ovih sposobnosti svaka klasa ima specifične značajke no kroz njih nećemo prolaziti
u ovom radu i dostupne su u \texttt{Player's Handbook}-u \cite{playershandbook2014}.

\begin{table}[h!]
    \centering
    \caption{Tablica klasa}
    \scriptsize
    \renewcommand{\arraystretch}{1.3}

    \begin{tabularx}{\linewidth}{|l|X|X|l|l|X|}
        \hline
        \textbf{Klasa} & \textbf{Opis} & \textbf{Vrsta kockica za životne bodove} & \textbf{Primarna sposobnost} & \textbf{Bacanja za spas} & \textbf{Stručnosti s oklopom i oružjem} \\ \hline
        Barbarin & Žestoki ratnik primitivnog podrijetla koji može ući u bojni bijes & D12 & Snaga & Snaga, izdržljivost & Laki i srednji oklopi, štitovi, jednostavno i borbeno oružje \\ \hline
        Bard & Nadahnjujući mađioničar čija moć odjekuje glazbom stvaranja & D8 & Karizma & Spretnost, karizma & Laki oklop, jednostavno oružje, ručni samostreli, dugi mačevi, rapiri, kratki mačevi \\ \hline
        Klerik & Svećenički prvak koji upravlja božanskom magijom u službi više sile & D8 & Mudrost & Mudrost, karizma & Laki i srednji oklopi, štitovi, jednostavno oružje \\ \hline
        Druid & Svećenik "Stare Vjere", upravlja moćima prirode i poprima životinjske oblike & D8 & Mudrost & Inteligencija, mudrost & Laki i srednji oklopi (nemetalni), štitovi (nemetalni), toljage, bodeži, strelice, koplja, mlatovi, štapovi, sablje, srpovi, praćke \\ \hline
        Borac & Majstor borbe, vješt s raznim oružjem i oklopima & D10 & Snaga ili spretnost & Snaga, izdržljivost & Svi oklopi, štitovi, jednostavno i borbeno oružje \\ \hline
        Redovnik & Majstor borilačkih vještina koji koristi snagu tijela za fizičko i duhovno savršenstvo & D8 & Spretnost, mudrost & Snaga, spretnost & Jednostavno oružje, kratki mačevi \\ \hline
        Paladin & Sveti ratnik vezan svetom zakletvom & D10 & Snaga, karizma & Mudrost, karizma & Svi oklopi, štitovi, jednostavno i borbeno oružje \\ \hline
        Rendžer & Ratnik koji koristi borilačku vještinu i magiju prirode za borbu protiv prijetnji & D10 & Spretnost, mudrost & Snaga, spretnost & Laki i srednji oklopi, štitovi, jednostavno i borbeno oružje \\ \hline
        Lupež & Nitkov koji koristi skrivanje i trikove kako bi svladao prepreke i neprijatelje & D8 & Spretnost & Spretnost, inteligencija & Laki oklop, jednostavno oružje, ručni samostreli, dugi mačevi, rapiri, kratki mačevi \\ \hline
        Čarobnjak & Bacač čarolija koji crpi urođenu magiju iz dara ili krvne loze & D6 & Karizma & Izdržljivost, karizma & Bodeži, strelice, praćke, štapovi, laki samostreli \\ \hline
        Vještac & Korisnik magije koja proizlazi iz pogodbe s izvanplanetarnim entitetom & D8 & Karizma & Mudrost, karizma & Laki oklop, jednostavno oružje \\ \hline
        Mag & Učeni korisnik magije sposoban manipulirati strukturama stvarnosti & D6 & Inteligencija & Inteligencija, mudrost & Bodeži, strelice, praćke, štapovi, laki samostreli \\ \hline
    \end{tabularx}
    \caption*{(Izvor: Player's Handbook \cite{playershandbook2014})}
    \label{tab:klase}
\end{table}
\clearpage

\subsection{Ostale značajke}
\label{section:ostale-znacajke}

U ostale značajke lika ubrajamo ime, spol, visinu i težinu, opredjeljenje, jezike, 
osobne karakteristike (osobine, ideale, veze, mane) i pozadinu.
Značajke opisuju način na koji bi se lik mogao ponašati tijekom igre.
Značajke kao ime, spol, visinu, težinu i osobne karakteristike igrač sam
kreira kako bi pobliže opisao svog lika i njegovo ponašanje u svijetu,
dok se značajke kao što su opredjeljenje, pozadina mogu birati 
(ili igrači/DM mogu kreirati pozadine) te će u nastavku ukratko biti opisani.

Opredjeljenje u opisuje likove moralne i osobne stavove te je kombinacija dvaju
faktora: jedan identificira moralnost (dobar, zao, neutralan), a drugi opisuje odnos
prema društvu i redu (zakonit, kaotičan, neutralan). Svaka kombinacija ovih dva faktora
ukupno definira devet mogućih kombinacija. 
Ovih devet opredjeljenja opisuju tipično ponašanje s tim opredjeljenjem, pojedinci
mogu značajno odstupati od tog tipičnog ponašanja \cite{playershandbook2014}:
\begin{itemize}
    \item Zakonito dobar (engl. \textit{Lawful good}) - 
        pojedinci će učiniti ispravnu stvar onako kako to društvo očekuje
    \item Neutralno dobar (engl. \textit{Neutral good}) -
        čine najbolje što mogu kako bi pomogli drugima u skaldu sa svojim potrebama
    \item Kaotično dobar (engl. \textit{Chaotic good}) -
        djeluju kako im savjest nalaže, s malo obzira prema onome što
        drugi očekuju
    \item Zakonito neutralan (engl. \textit{Lawful neutral}) -
        pojedinci djeluju u skaldu sa zakonom, tradicijom ili osobnim kodeksima
    \item Neutralan (engl. \textit{Neutral}) -
        opredjeljenje onih koji radije izbjegavaju moralna pitanja i ne
        zauzimaju strane, čineći ono što se u tom trenutku čini najboljim
    \item Kaotično neutralan (engl. \textit{Chaotic neutral}) -
        slijede svoju volju, držeći svoju osobnu slobodu iznad svega
    \item Zakonito zao (engl. \textit{Lawful evil}) -
        uzimaju ono što žele, unutar granica kodeksa tradicije, lojalnosti ili reda
    \item Neutralno zao (engl. \textit{Neutral evil}) -
        opredjeljenje onih koji čine sve što im može proći nekažnjeno,
        bez suosjećanja ili grižnje savjesti
    \item Kaotično zao (engl. \textit{Chaotic evil}) -
        djeluju s proizvoljnim nasiljem, potaknuti pohlepom,
        mržnjom ili željom za krvlju
\end{itemize}

Svaka priča ima neki početak te pozadina lika otkriva odakle lik dolazi,
kako je postao pustolov i koje je njegovo mjesto u svijetu. Odabir pozadine
pruža važne smjernice o identitetu lika te daje liku dodatne značajke kao
stručnost u nekoj vještini ili znanje nekog jezika. U samom primjeru izrade lika
će biti detaljno opisana jedna pozadina te sve dodatne značajke koje lik dobiva
i opremu s kojom počne.
Kratki popis pozadina \cite{playershandbook2014}:
\begin{itemize}
    \item Akolit (engl. \textit{Acolyte}) -
        osoba koja je provela život u službi hrama određenog boga,
        djelujući kao posrednik između svetog i smrtnog svijeta.
    \item Šarlatan (engl. \textit{Charlatan}) -
        osoba koja zna manipulirati ljudima i koristi trikove, prevare i lažne
        identitete za vlastitu korist.
    \item Kriminalac (engl. \textit{Criminal}) -
        iskusni prijestupnik s poviješću kršenja zakona i s kontaktima u podzemlju.
    \item Zabavljač (engl. \textit{Entertainer}) -
        osoba koja živi za nastup pred publikom i može ih zabaviti, očarati ili
        inspirirati.
    \item Narodni heroj (engl. \textit{Folk hero}) -
        osoba iz skromnog društvenog položaja, kojeg ljudi smatraju svojim
        prvakom protiv tiranije i čudovišta.
    \item Pustinjak (engl. \textit{Hermit}) - 
        osoba koja živi u samoći, pronalazeći tišinu i odgovore daleko od društva.
    \item Plemić (engl. \textit{Noble}) -
        osoba koja nosi plemićku titulu, posjeduje zemlju ili ima politički utjecaj i
        razumije bogatstvo i moć.
    \item Mudrac (engl. \textit{Sage}) -
        osoba koja je provela godine učeći o znanju svijeta i proučavajući rukopise.
    \item Mornar (engl. \textit{Sailor}) -
        osoba koja je godinama plovila na morskom plovilu, suočavajući se s olujama i čudovištima.
    \item Vojnik (engl. \textit{Soldier}) -
        osoba kojoj je rat bio život, obučena u borbi i preživljavanju na bojnom polju.
    \item Uličar (engl. \textit{Urchin}) -
        osoba koja je odrasla sama na ulici, siromašna i bez roditelja, preživljavajući
        zahvaljujući svojoj snalažljivosti.
\end{itemize}

\section{Primjer lika}
\label{section:primjer-lika}

U nastavku prolazimo kroz kreaciju lika po pravilima definiranim u prijašnjim
poglavljima. Lik će početi na prvoj razini.

Kreacija počinje s odabirom rase. Za rasu odabiremo poluorka, što znači da će lik imati
povećanu snagu i izdržljivost, snagu za dva boda, izdržljivost za jedan,
brzinu od 30 stopa te dobiva osobine vid u mraku (engl. \textit{darkvision}) i 
prijeteću prisutnost (engl. \textit{menacing}). Prijeteća prisutnost omogućava
stručnost u vještini zastrašivanja/prijetnje (engl. \textit{intimidation}).
Još dodatne dvije sposobnosti koje daje poluork rasa su nemilosrdna
izdržljivost (engl. \textit{relentless endurance}); kad je liku broj životnih
bodova smanjen na nulu, nije odmah ubijen, već pada na jedan životni bod i ne
može opet koristiti ovu sposobnost dok ne završi dugi odmor. 
Druga je divljački napadi (engl. \textit{savage attacks}); kad lik postigne
kritični pogodak napadom oružja u bliskoj borbi, može bacati još jednu
dodatnu kockicu od kockica štete oružja i dodati vrijednost šteti kritičnog pogotka.

Za klasu odabiremo barbarina, što znači da će lik koristiti kockicu D12 za akcije
vezane uz njegove životne bodove, npr. kod prelaska na višu razinu, ili kod kratkog/dužeg odmora.
Lik dobiva stručnosti s lakim i srednjim oklopima, štitovima, jednostavnim i borbenim oružjima.
Kod bacanja spasa koristi snagu i izdržljivost te odabira stručnosti u dvije vještine iz područja
rukovanja životinjama (engl. \textit{animal handling}), atletika (engl. \textit{athletics}),
zastrašivanja, prirode (engl. \textit{nature}), percepcije (engl. \textit{perception}) i
preživljavanja (engl. \textit{survival}).
Za ovog lika odabiremo stručnost u vještinama rukovanja životinjama i percepcije te je lik
također vješt u zastrašivanju zbog odabrane rase.
Jedinstvena sposobnost barbarina je bijes. Tokom bitke barbarin može pobjesniti 
korištenjem bonus akcije. Dok bjesni dobiva dodatne pogodnosti, ako ne nosi teški oklop;
ima prednost na provjere snage i bacanja za spašavanje snage;
kad napada oružjem za blisku borbu, koje koristi snagu, dobiva bonus na bacanje štete;
ima otpornost na neke vrste štete, otpornost na tučnjavu (engl. \textit{bludgeoning}),
na probijanje (engl. \textit{piercing}) i na sječenje (engl. \textit{slashing}).
Zadnja sposobnost koju lik dobiva od klase s prvom razinom je
neoklopljena obrana (engl. \textit{armored defense}); dok lik ne nosi oklop,
klasa oklopa (AC) je jednaka 10 + modifikator spretnosti + modifikator izdržljivosti \cite{playershandbook2014}.
Na višim razinama klase lik dobiva još više mogućnosti no ovdje nećemo proći
kroz njih.

Slijedeće je potrebno odrediti vrijednost i modifikator
svake sposobnosti i maksimum životnih bodova.
Postoji više načina na koji se mogu odrediti početne vrijednosti za 
sposobnosti, no u \textit{Player's Handbook-u} je preporučeno da se 
šest puta bace četiri D6 kockice te se kod svakog bacanja izbaci najmanja
kockica. Zbroj triju kockica određuje vrijednost jedne od sposobnosti te nakon
šest bacanja igrač može proizvoljno rasporediti vrijednosti po sposobnostima.
Modifikatori za sposobnosti se isčitavaju iz slijedeće tablice \cite{playershandbook2014}:

\begin{table}[h!]
    \centering
    \caption{Vrijednosti sposobnosti i modifikatori}
    \begin{tabularx}{0.66\linewidth}{|X|X|X|X|}
        \hline
        \textbf{Vrijednost} & \textbf{Modifikator} & \textbf{Vrijednost} & \textbf{Modifikator} \\ \hline
        1 & -5 & 16-17 & +3 \\ \hline
        2-3 & -4 & 18-19 & +4 \\ \hline
        4-5 & -3 & 20-21 & +5 \\ \hline
        6-7 & -2 & 22-23 & +6 \\ \hline
        8-9 & -1 & 24-25 & +7 \\ \hline
        10-11 & 0 & 26-27 & +8 \\ \hline
        12-13 & +1 & 28-29 & +9 \\ \hline
        14-15 & +2 & 30 & +10 \\ \hline
    \end{tabularx}
    \\[10pt]
    \caption*{(Izvor: Player's Handbook \cite{playershandbook2014})}
    \label{tab:vrijednost-sposobnosti-i-modifikatori}
\end{table}

Maksimalni broj životnih bodova na prvoj razini određuje vrsta klase, pošto je ovaj 
lik barbarin, broj životnih bodova će iznositi 12 + modifikator izdržljivosti.
Ispod se nalazi slika s primjerom popunjenog character sheet-a za ovog lika,
neki dijelovi su popunjeni, a nisu ovdje opisani, pošto su manje važni za razumijevanje
igre i direktno se isčitavaju iz pravila (npr. oprema koju lik dobiva).

\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{slike/vom_half-orc-p1.jpg}
    \caption{Primjer popunjenog character sheet-a}
    \label{fig:character-vom-half-orc}
\end{figure}

\section{Borba}
\label{section:borba}

Ovo poglavlje pruža pravila koja su potrebna kako bi likovi i čudovišta sudjelovali u borbi,
bilo da se radi o kratkom okršaju ili produženom sukobu. Kroz cijelo poglavlje
pravila se odnose na igrača ili DM-a. DM kontrolira sva čudovišta i likove koji nisu
igrači, a uključeni su u borbu, drugi igrači kontroliraju svoje likove.

Tipičan sukob je između dvije strane i organiziran je u ciklus rundi i poteza.
Runda predstavlja oko šest sekundi u svijetu igre. Tijekom runde, svaki sudionik
u bitci ima svoj potez. Redoslijed poteza određuje se na početku borbenog susreta,
kada svi bacaju inicijativu. Nakon što svi odrade potez, borba se nastavlja u
slijedeću rundu ako nijedna strana nije pobijedila drugu.

Prije početka borbe DM određuje tko bi mogao biti iznenađen na početku borbe.
Ako nijedna strana ne pokušava biti prikrivena automatski primjećuju jedna drugu
i ovaj korak se preskače, no ako se jedna strana uspješno prikrade ostvaruje prednost.
Strana koja je iznenađena, tj. lik ili čudovište koje je iznenađeno se ne može pomaknuti ili 
poduzeti akciju u svom prvom potezu borbe, također ne može poduzeti reakciju dok
taj prvi potez ne završi. Član grupe može biti iznenađen čak i ako ostali članovi nisu \cite{playershandbook2014}.

Inicijativa određuje redoslijed poteza tokom borbe. Kada borba počne svaki sudionik radi 
provjeru spretnosti (engl. \textit{dexterity check}) kako bi odredio svoje mjesto u poretku inicijative.
Baca D20 kockicu i na dobivenu vrijednost dodaje modifikator spretnosti.
DM određuje inicijativu za sve likove, čudovišta koje ne kontroliraju drugi igrači.
Nakon dobivenih vrijednosti za inicijativu, DM ih rangira od najviše do najmanje
vrijednosti te određuje redoslijed poteza. U slučajevima kad igrači imaju istu
inicijativu mogu međusobno odrediti tko nastupa prvi, ako čudovište i igrač imaju
jednaku inicijativu DM određuje redoslijed.

\subsection{Igračev potez}
\label{section:igracev-potez}

Kad je igrač na potezu može pomicati svog lika do udaljenosti
određenom brzinom lika i odraditi jednu akciju. U pravilu svako polje je veličine
pet sa pet stopa, što bi značilo da se lik s brzinom od trideset
stopa može pomaknuti maksimalno šest polja.
Igrač odlučuje da li će se prvo kretati ili odraditi akciju.
U poglavlju \ref{section:akcije} će biti opisane najčešće akcije koje likovi mogu
odraditi, mnoge značajke različitih klasa i druge sposobnosti koje pružaju dodatne opcije za akcije.

Razne značajke klase, čarolije i druge sposobnosti omogućavaju poduzimanje dodatne akcije u 
trenutnom potezu. Dodatna akcija se može jedino poduzeti u slučaju kad značajka klase,
čarolija ili neka druga sposobnost navodi da se nešto može odraditi kao dodatna akcija.
Po potezu, jednako kao s akcijom, može se odraditi samo jedna dodatna akcija te ako
lik ima dostupno više dodatnih akcija potrebno je odrediti koju je najbolje iskoristiti u tom
slučaju \cite[str. 189]{playershandbook2014}.

Kao dio poteza lik može stupiti u interakciju s jednim predmetom ili značajkom
okoline, ta interakcija se može dogoditi tijekom kretanja ili akcije.
Na primjer, otvaranje vrata dok se lik kreće prema neprijatelju ili izvlačenje
oružja kao dio iste akcije za napad bi spadale pod interakciju s okolinom.

Određene posebne sposobnosti, čarolije i situacije omogućuju poduzimanje posebne akcije
zvane reakcija. Reakcija je trenutni odgovor na okidač neke vrste, koji se može dogoditi
tokom poteza igrača ili tuđeg poteza. Napad prilike (engl. \textit{Opportunity attack}) je 
najčešća vrsta reakcije i više je opisana u poglavlju \ref{section:napadi}.

\subsection{Kretanje i položaj}
\label{section:kretanje-i-polozaj}

Kad je lik na potezu može se pomaknuti do udaljenosti definirane brzinom lika.
Po potezu lik može potrošiti proizvoljnu količinu brzine, ne mora potrošiti svu
ili uopće iskoristiti brzinu.
Kretanje se može razdijeliti kroz cijeli potez. Moguće je koristiti dio brzine prije
i poslije akcije. Na primjer, ako je brzina lika trideset stopa, može se kretati deset stopa,
iskoristiti neku akciju, a zatim se kretati još dvadeset stopa.
Ako akcija uključuje više od jednog napada oružjem, kretanje se može dodatno razdvojiti
između tih napada.

Borbe se rijetko odvijaju u praznim sobama. Špilje pune kamenja i guste šume
su tipična mjesta odvijanja borbe i sadrže težak teren (engl. \textit{difficult terrain}).
Za svako kretanje kroz ovakav teren potrebno je utrošiti jednu dodatnu stopu za svaku stopu
koju lik želi preći. Na primjer, ako se radi o udaljenosti od pet stopa, za prolaz kroz
težak teren potrebno je utrošiti deset stopa brzine \cite[str. 190]{playershandbook2014}.

Likovi se mogu kretati kroz prostor prijateljskih stvorenja, ali ne mogu završiti potez
ili zaustaviti se na istom polju. Kroz prostor neprijateljskih stvorenja mogu se kretati samo
ako je stvorenje barem dvije veličine veće ili manje od lika koji se kreće, no nije dozvoljeno
završavanje kretanja u prostoru koji zauzima to stvorenje \cite[str. 191]{playershandbook2014}.

U tablici ispod se nalaze veličine stvorenja i različite količine prostora koje zauzimaju,
tokom borbe veća stvorenja kontroliraju veću količinu prostora, također objekti u okolini ponekad
mogu koristiti kategorije veličine. 
Prostor stvorenja je područje u stopama koje to stvorenje kontrolira tokom borbe, a nije
izraz njihovih fizičkih dimenzija.

\begin{table}[H]
    \centering
    \caption{Kategorije veličine}
    \begin{tabularx}{0.66\linewidth}{|X|X|}
        \hline
        \textbf{Veličina} & \textbf{Prostor} \\ \hline
        Sićušan & 2.5 sa 2.5 stopa \\ \hline
        Mala & 5 sa 5 stopa \\ \hline
        Srednja & 5 sa 5 stopa \\ \hline
        Velika & 10 sa 10 stop \\ \hline
        Ogromna & 15 sa 15 stopa \\ \hline
        Gigantska & 20 sa 20 stopa ili više \\ \hline
    \end{tabularx}
    \\[10pt]
    \caption*{(Izvor: Player's Handbook \cite[str. 191]{playershandbook2014})}
    \label{tab:kategorije-velicine}
\end{table}

\subsection{Akcije}
\label{section:akcije}

Kad je lik na potezu i želi odraditi neku akciju, osim akcija koje dobiva od klase ili
nekih drugih posebnih značajki uvijek može odraditi neku od slijedećih akcija 
ili improvizirati akciju. Ako je akcija improvizirana DM odlučuje ako je moguća,
koju vještinu lik može iskoristiti za akciju i kakvo bacanje kockice će odrediti
uspješnost akcije.

\textbf{Napad} je najčešća akcija u borbi, bilo da se zamahuje mačem,
ispaljuje strijela iz luka ili tučnjava šakama, ovom akcijom izvodi se jedan napad
izbliza ili napad na daljinu \cite[str. 192]{playershandbook2014}.
Napadi će biti detaljnije opisani u poglavlju \ref{section:napadi}.

\textbf{Bacanje čarolija}, mnoge vrste čudovišta i likova imaju pristup čarolijama i mogu ih
koristiti u borbi. Svaka čarolija ima definirano vrijeme bacanja (engl. \textit{cast time}),
koje određuje mora li bacač koristiti akciju, reakciju, minute ili sate vremena da baci čaroliju.
U nekim slučajevima, kao kad čarolija ima vrijeme bacanja od više sati, bacanje čarolije nije
nužno jedna akcija. Većina čarolija ima vrijeme bacanja od jedne akcije, pa je često takva čarolija
korištena tokom borbe \cite[str. 192]{playershandbook2014}.

\textbf{Trk} (engl. \textit{dash}), omogućava liku da potroši akciju kako bi se mogao
na istom potezu dodatno kretati. Povećanje je jednako brzini lika, nakon što se primjene
bilo kakvi modifikatori brzine. Na primjer, s brzinom od trideset stopa, na istom potezu
moguće je pomaknuti se šestdeset stopa ako se iskoristi ova akcija.
Bilo kakve promjene na brzinu također imaju utjecaj na dodatnu brzinu dobivenu ovom akcijom,
na primjer ako je lik usporen i ima smanjenu brzinu s trideset na petnaest, korištenjem ove akcije
će dobiti dodatnih petnaest brzine \cite[str. 192]{playershandbook2014}.

\textbf{Isključivanje iz borbe} (engl. \textit{disengage}), akcija omogućuje kretanje bez da
neprijatelji dobivaju napad prilike kad se lik kreće oko njih \cite[str. 192]{playershandbook2014}.

\textbf{Izmicanje} (engl. \textit{dodge}), akcija omogućava usredotočenost na izbjegavanje napada.
Do početka slijedećeg poteza, svako bacanje napada protiv lika koji je iskoristio ovu akciju,
ima odsutnost prednosti ako lik vidi napadača, a sva bacanja za spas
na spretnost se izvode s prednošću \cite[str. 192]{playershandbook2014}.

\textbf{Pomoć}, likovi mogu pružiti pomoć drugom liku u izvršavanju nekog zadatka.
Korištenjem ove akcije drugi lik dobiva prednost na slijedeću provjeru sposobnosti koju
izvrši za obavljanje zadatka u kojem dobiva pomoć, pod uvjetom da napravi tu radnju prije
nego pomagač opet dođe na potez. Također moguće je pomoći prijateljskom stvorenju u napadu
na neprijatelja unutar pet stopa, napadač na svom potezu dobiva prednost na prvo bacanje za 
napad \cite[str. 192]{playershandbook2014}.

\textbf{Pretraga}, akcija može biti iskorištena za pretragu okoline i pronalaženju nečega.
Ovisno o prirodi pretrage, DM može zatražiti da se napravi provjera vještine percepcija ili 
istraga \cite[str. 193]{playershandbook2014}.

\subsection{Napadi}
\label{section:napadi}

Napade možemo podijeliti u nekoliko vrsta, napadi na blizinu, na daljinu i
napadi prilike. Svaka vrsta napada se ima razlike no svi imaju jednaku
strukturu i način na koji se izvode \cite[str. 193-194]{playershandbook2014}:
\begin{enumerate}
    \item Odabir mete; potrebno je odabrati metu unutar dometa napada,
        meta može biti stvorenje, predmet ili lokacija. Na primjer,
        lokacija se može odabrati ako pokušavamo napasti nevidljivog
        neprijatelja ili ako čarolija koju bacamo ima utjecaj na veće
        područje.
    \item Određivanje modifikatora; DM određuje ako se meta skriva iza zaklona
        i ako napadač ima prednost ili nema prednost protiv mete. Uz to,
        čarolije, posebne sposobnosti i drugi učinci mogu imati utjecaja.
    \item Razriješivanje napada; igrač radi bacanje za napad (engl. \textit{attack roll}),
        ovo bacanje određuje ako je meta uspješno pogođena napadom ili je napad promašio.
        U slučaju pogotka određuje se šteta koja je napravljena meti, također bacanjem kockice,
        ovisno o napadu koriste se različite kockice, neki napadi uzrokuju posebne učinke
        uz štetu ili umjesto nje.
\end{enumerate}

Za izvođenje bacanja za napad koristi se D20 kockica te se na dobivenu vrijednost dodaju
određeni modifikatori. Ako je ukupan zbroj bacanja i modifikatora jednak ili veći od klase
oklopa mete, u tom slučaju napad pogađa. Dva najčešća modifikatora koji se dodaju
su modifikator sposobnosti (engl. \textit{ability modifier}) i bonus stručnosti lika.
Modifikator sposobnosti odgovara sposobnosti koja se koristi za napad, npr. može biti snaga
ili spretnost ovisno o vrsti oružja. Bonus stručnosti se dodaje ako lik ima stručnost u korištenju
oružja kojim napada.

U rjeđim slučajevima kao rezultat bacanja D20 moguće je dobiti 1 ili 20. Ako je
dobivena vrijednost 20, napad je uvijek pogodak, neovisno o bilo kakvim modifikatorima
ili klasi oklopa mete, također ovakav napad je uvijek kritičan pogodak.
Ako je dobivena vrijednost 1, napad uvijek promašuje i ne dodaje se modifikator ni
ne provjerava klasa oklopa mete.
Slična funkcija je kod ostalih bacanja D20, vrijednost od 20 je skoro uvijek uspjeh
dok je vrijednost 1 neuspjeh.

\subsection{Šteta i iscjeljivanje}
\label{section:steta-i-iscjeljivanje}

Ozljede i rizik od smrti stalni su pratitelji onih koji istražuju svjetove D\&D-a.
Životni bodovi predstavljaju kombinaciju fizičke i mentalne izdržljivosti.
Stvorenje s više životnih bodova teže je ubiti ili onesvijestiti. Ona s manje
životnih bodova su krhkija. Trenutni životni bodovi stvorenju mogu biti bilo koji
broj između nule i maksimuma životnih bodova.
Kad stvorenje pretrpi štetu, ta se šteta oduzima od životnih bodova,
gubitak životnih bodova nema utjecaj na sposobnosti stvorenja sve dok je
vrijednost veća od nule.

Ako šteta ne rezultira smrću stvorenja, tada nije trajna. Likovi mogu
vratiti životne bodove odmorom, korištenjem čarolija ili ispijanjem ljekovitog
napitka. Kada stvorenje primi iscjeljivanje bilo koje vrste, vraćeni životni bodovi
dodaju se trenutnim životnim bodovima i ne mogu premašiti maksimum životnih bodova
tog lika ili stvorenja.

Postoji nekoliko situacija koje se mogu dogoditi kad neki lik ili stvorenje padne na 
nula životnih bodova. Manje važna stvorenja, čudovišta uglavnom umiru odmah
nakon što im životni bodovi padnu na nulu, dok važniji likovi mogu pasti u
nesvijest ili imati nekoliko pokušaja da se spase od smrti i stabiliziraju
svoje stanje.
U slučaju kad količina štete svede lika na nula životnih bodova i ostatak
štete je veći ili jednak broju maksimalnih životnih bodova lika, lik umire u tom
trenutku.
Padom u nesvijest tijekom borbe znači da lik ili stvorenje na svom potezu
mora izvršiti bacanje za spas od smrti (engl. \textit{death save}).
Za spas se koristi D20 i sve vrijednosti jednake ili veće od deset
približavaju lika životu, dok sve ispod deset smrti.
Na treći uspjeh lik postaje stabilan te se više ne mora spašavati od smrti,
dok na treći neuspjeh lik umire. Bacanje dvadeset broji se kao dva uspijeha, 
a bacanje jedan se broji kao dva neuspjeha.
Stabilizirano stvorenje ima nula životnih bodova i onesviješteno je, odmorom
se životni bodovi mogu povratiti, no odmor traje neko vrijeme i nije moguć
tokom borbe. Tokom borbe iscjeljivanje na barem jedan životni bod
je jedini način za osvijestiti lika ili stvorenje.

\chapter{Prikaz implementacije}
\label{chapter:prikaz-implementacije}

U ovom poglavlju će biti opisani alati i tehnologije korištene za implementaciju platforme.
Korišteno je više različitih tehnologija, fokus je na odabir i korištenje tehnologija 
koje su što više prikladne za implementacije web aplikacija.
Ovime se osigurava da je aplikacija dostupna, funkcionalna i prenosiva
preko više različitih operativnih sustava i web preglednika.

Platforma je implementirana na način da može biti korištena kao zasebna web
aplikacija koja se spaja na udaljeni poslužitelj ili kao desktop aplikacija
koja automatski u pozadini pokreće poslužitelj i omogućava korisniku 
korištenje aplikacije bez posebnog pokretanja i postavljanja poslužitelja.
Desktop i mobilna integracija je moguća kroz korištenje tauri programskog okvira.

Tauri je programski okvir za izgradnju malih, brzih programa za sve desktop i mobilne platforme.
Aplikacija može integrirati bilo koji frontend okvir koji se kompajlira u HTML, javascript, css
i koristiti ove tehnologije za razvoj korisničkog sučelja, a istovremeno može koristiti jezike
poput rusta, swifta, jave i kotlina za backend logiku i interakciju s hardverom \cite{tauridocs}.
U ovom projektu tauri služi za pakiranje projekta u jednu izvršnu datoteku te jednostavno
postavljanje i pokretanje poslužitelja i jednog klijenta.

Aplikacija se sastoji od dva odvojena dijela, to su poslužitelj i klijent.
Poslužitelj služi za spremanje podataka, spajanje i sinkronizaciju podataka između
povezanih klijenata te učitavanje slika, kako bi bile dostupne klijentima preko web API-a,
te kreiranje manjih sličica (engl. \textit{thumbnail}) iz učitanih slika, da klijenti ne bi
trebali preuzimati cijele slike koje mogu biti veće rezolucije, a nikada neće biti potrebna
takva rezolucija. Klijent sadrži svo korisničko sučelje i logiku igre, komunicira kroz
poslužitelja s ostalim klijentima te prima promjene o stanju igre od poslužitelja.

Cijela aplikacija je umrežena, sve promjene koje se događaju kod jednog klijenta budu
sinkronizirane i prikazane kod ostalih klijenata koji su povezani u istu sesiju.
% Aplikacija koristi ravnopravne čvorove (engl. \textit{peer-to-peer})
% za umrežavanje zbog jednostavnosti implementacije i
% veće fleksibilnosti, prije implementacije u obzir je došlo umrežavanje s autoritativnim poslužiteljem,
% više o oba pristupa i zašto je odabrano peer-to-peer umrežavanje u poglavlju \ref{section:mrezna-komunikacija}.

\section{Web aplikacije}
\label{section:web-aplikacije}

Web aplikacija je program klijent-poslužitelj arhitekture koji koristi
web preglednik kao svog klijenta. Web aplikacija obavlja interaktivnu
uslugu povezivanja s poslužiteljem putem interneta ili intraneta \cite{shklar2009web}.

Razlikuje se od tradicionalne web stranice na slijedeće načine \cite{shklar2009web}:
\begin{itemize}
    \item \textbf{Dinamičko naspram statičkog}: dok web stranica, u većini slučajeva
        isporučuje sadržaj statičkih datoteka, web aplikacija prikazuje dinamički prilagođen
        sadržaj na temelju parametara zahtjeva, korisničke sesije.
    \item \textbf{Interaktivnost}: web aplikacije omogućuju korisnicima obavljanje specifičnih
        zadataka, poput kupnje robe ili upravljanje zalihama.
\end{itemize}

Web aplikacije se temelje na distribuiranoj arhitekturi koja se sastoji od tri glavna elementa.
Prvi element je klijent još nekad i nazivan frontend; to je obično web preglednik instaliran
na korisnikovom računalu. Preglednik je odgovoran za prikazivanje sadržaja i rukovanje interakcijama
korisnika.
Drugi element je poslužitelj, ponekad zvan backend; ovaj element sluša dolazne zahtjeve od
klijenata i generira odgovore. Obrađuje zadatke poput posluživanja statičkih datoteka,
autentifikacije i prosljeđivanja dinamičkih zahtjeva aplikacijskim programima.
Treći element je baza podataka; web aplikacije često zahtijevaju pristup trajnim podacima.
Povezuju se s bazama podataka kako bi pohranile i dohvaćale informacije.
Arhitektura aplikacije uključuje specifičnu logiku za omogućavanje pristupa podacima i
upravljanje transakcijama \cite{casteleyn2009engineering}.

\section{Poslužitelj}
\label{section:posluzitelj}

% U ovom potpoglavlju prolazimo kroz implementaciju poslužitelja, tehnologije koje su
% korištene i odluke koje su donesene vezane uz dizajn cijele aplikacije, kao što je
% odluka za implementaciju peer-to-peer umrežavanja umjesto autoritativnog poslužitelja.

Poslužitelj je implementiran u programskom jeziku rust. Rust je sistemski programski jezik
sa statičnim tipovima podataka, dizajniran za performanse i sigurnost. 
Razvijen od strane Mozilla Research, stvoren je kao odgovor na dugogodišnju napetost između
kontrole na niskoj razini koju pruže jezici poput C i C++-a i sigurnosti jezika više razine
poput jave ili pythona. Rust sigurnost postiže sustavom koji se zove vlasništvo (engl. \textit{ownership}) i 
provjeravanjem vlasništva nad varijablama tokom kompajliranja programa sustavom zvanim provjeravač
posuđenog (engl. \textit{borrow checker}). Korištenjem ova dva sustava osigurava korektan pristup
i dijeljenje memorije, izbjegava probleme s korištenjem izbrisane memorije, čitanja ili
pisanje u memoriju koju više dretva istovremeno koristi, a pristup memoriji nije sinkroniziran \cite{rustdocs}. 

Budući da rust nema sakupljača smeća (engl. \textit{garbage collector}) i ima minimalan runtime,
nevjerojatno je brz i memorijski učinkovit. Kod kompajliranja programa koristi apstrakcije bez troška, što
znači da programer može koristiti koncepte programiranje više razine, poput iteratora ili generičnih funkcija,
bez da računalo obavlja dodatni posao tijekom izvođenja, svi koncepti više razine tokom kompajliranja su 
pretvoreni u nižu razinu, na primjer iteratori su pretvoreni u jednostavne for petlje, dok su generične funkcije
pretvorene u više različitih funkcija koje kompajlirani program poziva \cite{rustdocs}.

\subsection{Protokoli za prijenos podataka između poslužitelja i klijenta}
\label{section:protokoli}

Implementirani poslužitelj koristi http i websockete za komunikaciju s klijentima.
HTTP je protokol na kojim se temelji world wide web, dizajniran je za prijenos specijaliziranih
poruka putem mreže. Koristi TCP kao svoj temeljni transportni sloj, što osigurava da su svi podaci
preneseni u točnom redoslijedu i primljeni. Komunikacija http-a koristi model zahtjeva i odgovora.
HTTP klijent poput web preglednika započinje komunikaciju slanje poruke zahtjeva prema http
poslužitelju. Poslužitelj zatim zaprima zahtjev, obrađuje ga i generira poruku odgovora koju šalje
natrag klijentu. Na ovaj način klijent može zatražiti bilo kakvu vrstu resursa od poslužitelja \cite{casteleyn2009engineering}.

HTTP zahtjev se sastoji od nekoliko dijelova i počinje s metodom zahtjeva, putanju do resursa i broj verzije http-a,
slijedeći redovi su popis zaglavlja, nakon zaglavlja je prazni redak iza kojeg se u poruku dodaje tijelo.
Tijelo je opcionalno i ne mora biti prisutno u poruci. Ispod je primjer zahtjeva, korištena je metoda GET, pokušava se dohvatiti
resurs index.html, verzija HTTP-a je 1.1 i u zahtjev uključeno je jedno zaglavlje, tijelo je prazno.
Ovakvi zahtjevi su uglavnom slani od klijenta prema poslužitelju, no nije neubičajeno da dva poslužitelja komuniciraju
preko http-a te u ovom slučaju jedan poslužitelj preuzima ulogu klijenta.

\begin{verbatim}
GET /index.html HTTP/1.1
User-Agent: Mozilla/5.0(X11;Linux x86_64) Chrome/143.0.0.0
\end{verbatim}

Klijent od poslužitelja prima odgovor na zahtjev. Struktura odgovora počinje statusnom linijom,
koja sadrži verziju http-a, troznamenkasti statusni kod i kratko objašnjenje poslanog koda, npr. OK.
U odgovoru, jednako kao kod zahtjeva, nakon prve linije dolazi lista zaglavlja koja su poslana te
nakon zaglavlja prazni redak i tijelo odgovora. U slučaju ispod tijelo je popunjeno i klijent prima
html dokument koji može prikazati u web pregledniku.

\begin{verbatim}
HTTP/1.1 200 OK
Content-Type: text/html
Content-Lenght: 40

<html><h1>Hello World!</h1></html>
\end{verbatim}

HTTP protokol je protokol bez stanja, što znači da je životni vijek veze između klijenta 
i poslužitelja ograničen na jednu razmjenu zahtjeva i odgovora. Poslužitelj ne održava stanje
veze tijekom prijenosa uzastopnih naredbi. Ne može pamtiti niz interakcija niti grupirati
zahtjeve zajedno. Budući da protokol ne održava informacije o sesiji, web aplikacije
moraju koristiti druge mehanizme, poput kolačića za uspostavljanje trajnih sesija ili stanja
kroz višestruke zahtjeve \cite{casteleyn2009engineering}.

Websocket je protokol koji omogućuje dvosmjernu komunikaciju između klijenta i poslužitelja
preko jedne, dugotrajne TCP veze. Za razliku od klasičnog http-a koji koristi model
zahtjev odgovor, websocket omogućuje da obje strane šalju poruke u bilo kojem trenutku, bez
potrebe za novim zahtjevima \cite{pimentel2012communicating}.
Ova karakteristika je idealna za aplikacije koje zahtijevaju ažuriranja u stvarnom vremenu i možemo
nazvati websocket kao protokol koji održava stanje, za razliku od http-a koji je bez stanja.
Uspostava websocket veze počinje kao običan http zahtjev koji je nadograđen na websocket protokol.
Klijent šalje posebni http GET zahtjev s zaglavljem \texttt{Upgrade: websocket}. 
Poslužitelj odgovara statusom \texttt{101 Switching Protocols} ako prihvaća zahtjev.
Nakon ovoga, veza prelazi na websocket protokol. Poruke se šalju u obliku okvira i
postoji nekoliko vrsta okvira, to su tekst okviri, za slanje tekstualnih poruka,
binarni okviri, za slanje biranih poruka i kontrolni okviri, za slanje keep-alive
poruka i zatvaranje veze \cite{gupta2018overview}.
U kasnijim poglavljima su prikazani primjeri gdje i kako se oba protokola koriste.

\subsection{Axum}
\label{section:axum}

Axum je okvir za izradu web aplikacija u ekosustavu programskog jezika rust, dizajniran
za izgradnju asinkronih http usluga s naglaskom na ergonomiju, modularnost i kompozabilnost.
Pruža visokorazinsku apstrakciju za usmjeravanje, obradu zahtjeva i generiranje odgovora, 
dok koristi nižerazinske komponente iz asinkronog rusta. Naglašava tipksi sigurno usmjeravanje
bez korištenja makro komandi i mehanizme ekstrakcije, omogućujući deklarativno parsiranje
zahtjeva putem ekstraktora, na primjer pruža ekstraktore za parametre puta ili parsiranje
JSON tijela zahtjeva \cite{axum}.

Axum se u aplikaciji koristi kao web poslužitelj, odgovoran je za povezivanje klijenata,
spajanje s bazom podataka, pohranjivanje podataka o igrama te upravljanje i 
serviranje slika koje klijenti pohrane za neku igru. Kroz nekoliko primjera koda
ćemo proči glavne značajke axum-a i način na koji se koristi kroz aplikaciju.

\begin{figure}[H]
\centering
\begin{minted}[samepage]{rust}
pub fn get_router<T: AppStateTrait>(state: T) -> axum::Router {
    axum::Router::new()
        .route("/assets/upload", routing::post(upload::upload))
        .route(
            "/assets/thumbnails/{image_id}",
            routing::get(serve::thumbnails),
        )
        .route("/assets/{filename}", routing::get(serve::serve_file))
        .layer(DefaultBodyLimit::disable())
        .layer(RequestBodyLimitLayer::new(FILE_SIZE_LIMIT))
        .with_state(state.clone())
}
\end{minted}
\captionof{listing}{Kreiranje axum ruta za učitavanje i serviranje slika}
\label{lst:kreiranje-axum-ruta-za-ucitavanje-i-serviranje-slika}
\end{figure}

U isječku koda \ref{lst:kreiranje-axum-ruta-za-ucitavanje-i-serviranje-slika}
je prikazana funkcija koja kreira axum \texttt{Router} objekt s globalnim stanjem aplikacije
\texttt{state}. U funkciji su definirane tri različite rute, detalji o rutama su u poglavlju \ref{section:endpoints}.
Funkcija \texttt{route} kao argumente prima putanju na koju će web poslužitelj reagirati ako
je zatražena od klijenta, drugi argument registrira http metodu i funkciju koja se poziva za 
generiranje odgovora na klijentov zahtjev. Na primjer \texttt{route("/assets/upload", routing::post(upload::upload))}
registrira rutu \texttt{"/assets/upload"}, definira da prima samo zahtjev za \texttt{POST} metodu,
te ako klijent napravi ispravan zahtjev na ovu rutu poziva funkciju \texttt{upload::upload}.
Funkcija \texttt{with\_state} prima dijeljeno globalno stanje aplikacije i omogućava
funkcijama koje generiraju odgovor klijentu pristup tome stanju, na primjer stanje
može sadržavati vezu na bazu podataka. U slijedećem isječku je prikazana struktura
globalnog dijeljenog stanja.

\begin{figure}[H]
\centering
\begin{minted}[samepage]{rust}
pub struct AppStateConfig<F>
where
    F: Adapter,
{
    pub file_system_handler: F,
    pub database: DatabaseConnection,
    pub entity_queue: Arc<Mutex<EntityQueue>>,
}

impl AppStateConfig<local_adapter::Local> {
    pub async fn get_default_config() -> AppStateConfig<local_adapter::Local> {
        let database = Self::get_database().await;
        let entity_queue = Arc::new(Mutex::new(EntityQueue::new(database.clone())));
        Self {
            file_system_handler: Self::get_fs_handler_from_config(),
            database,
            entity_queue,
        }
    }
}

impl<F> AppStateTrait for AppState<F> where F: Adapter
{
    type FsHandler = F;

    fn get_fs_handler(&self) -> Self::FsHandler { self.fs_handler.clone() }
    fn get_db(&self) -> DatabaseConnection { self.database.clone() }
    fn get_entity_queue(&self) -> Arc<Mutex<EntityQueue>> { self.entity_queue.clone() }
    fn get_scheduler(&self) -> Scheduler { self.scheduler.clone() }
}

\end{minted}
\captionof{listing}{Implementacija dijeljenog globalnog stanja}
\label{lst:implementacija-dijeljenog-globalnog-stanja}
\end{figure}

Zbog jednostavnosti aplikacija koristi jedno globalno stanje, iako axum podržava
različito stanje za svaki \texttt{Router} objekt. Globalno stanje se sastoji od
objekta za upravljanje datotekama te u ovom slučaju stanje koristi implementaciju za
pristup datotekama na lokalnom računalu tj. pristup datoteka na računalu koje pokreće
poslužitelj. Stanje se također sastoji od veze s bazom reda čekanja entiteta \texttt{EntityQueue}.
Red čekanja entiteta će biti detaljnije objašnjen u kasnijem poglavlju, no za sad je samo bitno
znati da postoji u globalnom stanju i bude dostupan kroz ekstraktore u funkcijama za generiranje
odgovora na zahtjeve klijenta.

\begin{figure}[H]
\centering
\begin{minted}[samepage]{rust}
pub async fn upload<F: Adapter>(
    asset_manager: AssetManager<F>,
    conn: DbConn,
    multipart: extract::Multipart,
) -> Result<Json<UploadResponse>> {
    let file = UploadedFile::from_multipart(multipart).await?;

    let transaction = conn.begin().await?;

    let asset = asset_manager
        .create(
            &transaction,
            file.name.to_string(),
            &file.data,
            AssetType::File,
        )
        .await?;

    let thumbnails = if infer::is_image(&file.data) {
        asset_manager
            .create_thumbnail_assets(&transaction, &asset, Some(&file.data))
            .await?
    } else { vec![] };

    transaction.commit().await?;

    Ok(Json(UploadResponse {
        id: asset.id,
        thumbnails: thumbnails
            .into_iter()
            .map(|t| gen_partial_asset_url(&t.name))
            .collect(),
        url: gen_partial_asset_url(&asset.name),
        filename: asset.name,
        original_filename: asset.original_filename,
    }))
}
\end{minted}
\captionof{listing}{Implementacija upload funkcije za učitavanje datoteka na poslužitelja}
\label{lst:implementacija-upload-funkcije-za-ucitavanje-datoteka-na-posluzitelj}
\end{figure}

Isječak \ref{lst:implementacija-upload-funkcije-za-ucitavanje-datoteka-na-posluzitelj}
prikazuje cijelu implementaciju funkcije za učitavanje datoteke s klijenta na poslužitelja.
U isječku \ref{lst:implementacija-dijeljenog-globalnog-stanja} 
definirana je struktura globalnog stanja koju aplikacija koristi, a u ovoj funkciji
se koriste dva objekta izvedena iz tog stanja. Ti objekti su \texttt{AssetManager<F>} i
\texttt{DbConn}, dok axum pruža implementaciju za \texttt{extract::Multipart}.
Funkciju ni u jednom trenutku ne pozivamo ručno, već kroz registraciju rute i korištenjem
rust kompajlera axum generira poziv na definiranu funkciju s točnim parametrima.
To radi na način da svi parametri funkcije moraju implementirati trait \texttt{FromRequestParts},
što omogućava axum-u mogućnost izvlačenja, postavljanja i prilagođavanje parametara.

Nadalje u funkciji se axum-ov ekstraktor \texttt{extract::Multipart} koristi za dobivanje podataka
o datoteci koja se šalje poslužitelju, nakon izvlačenja podataka pokreće se transakcija na razini
baze podataka. Transakcija osigurava da će se u bazu zapisati podaci o učitanom dokumentu samo
ako sve prođe bez greške. Ako se u bilo kojem trenutku kod pisanja podataka u bazu ili kasnijeg
generiranja sličica originalne datoteke dogodi greška od koje se aplikacija ne može oporaviti,
transkacija će biti obustavljena i podaci neće biti zapisani u bazu podataka.
Kod završetka funkcije generira se odgovor koji se šalje klijentu. Odgovor je u JSON formatu,
format je vidljiv kroz tip podataka koji funkcija vraća \texttt{Json<UploadResponse>}.

\begin{figure}[H]
\centering
\begin{minted}[samepage]{rust}
pub struct DbConn(DatabaseConnection);
impl<S> FromRequestParts<S> for DbConn
where
    S: AppStateTrait,
{
    type Rejection = Error;

    async fn from_request_parts(
        _parts: &mut Parts,
        state: &S,
    ) -> core::result::Result<Self, Self::Rejection> {
        Ok(state.get_db().into())
    }
}
\end{minted}
\captionof{listing}{Implementacija ekstraktora za vezu s bazom podataka}
\label{lst:implementacija-ekstraktora-za-vezu-s-bazom-podataka}
\end{figure}

Isječak iznad prikazuje implementaciju traita \texttt{FromRequestParts} koji omogućava
axum-u te na kraju programeru korištenje prilagođenih ekstraktora u funkcijama za generiranje
odgovora na klijentove zahtjeve. U isječku je definirano da varijabla \texttt{state} mora implementirati
\texttt{AppStateTrait} (implementacija vidljiva u isječku \ref{lst:implementacija-dijeljenog-globalnog-stanja})
što garantira varijabli \texttt{state} posjedovanje metode \texttt{get\_db} i sposobnost kreiranja veze s bazom podataka.
Tu vezu dalje axum može proslijediti u funkcije koje koriste ekstraktor \texttt{DbConn}.

\subsection{Socketioxide i Socket.IO}
\label{section:socketioxie}

Socketioxide je implementacija socket.io poslužitelja \cite{socketioxide} u rust-u. 
Biblioteka je prigodna za aplikaciju jer ima direktnu integraciju s axum-om.
Socket.IO je biblioteka koja omogućava koja omogućuje događanjima vođenu dvosmjernu komunikaciju u stvarnom
vremenu između web klijenata, obično web preglednika i poslužitelja. 
Namijenjen je aplikacijama koje zahtijevaju trenutno slanje podataka između klijenta i
poslužitelja, s minimalnim kašnjenjem.
Za potrebe aplikacije socket.io je korišten za uspostavljanje websocket veze između
klijenata i poslužitelja te za prosljeđivanje podataka s jednog klijenta na drugi,
bez da ti klijenti moraju biti direktno povezani jedni s drugima.

Komunikacija kroz socket.io je bazirana na slanju događaja između klijenta i poslužitelja.
Da bi se neki dio koda izvršio primitkom određenog događaja, klijent ili poslužitelj 
trebaju imati registriran slušatelj (engl. \textit{listener}) za taj događaj.
Na primjer, u isječku koda \ref{lst:postavljanje-socketioxide-poslužitelja-kao-axum-rutu}
postoji linija \texttt{socket.on(JOIN\_EVENT, join\_handler::<T>);} koja označava da će
poslužitelj reagirati na događaj \texttt{JOIN\_EVENT} koji dobije od klijenta.

Isječak koda ispod prikazuje način na koji se socketioxide integrira s
axum-om, kako se kreira namespace i ruta na koji se klijenti mogu spajati,
te dodatne postavke vezane za spajanje i održavanje veze s klijentom, također
opet je vidljivo globalno stanje aplikacije \texttt{AppStateTrait} koje se prosljeđuje
u socketioxide kontekst kako bi i socketioxide imao pristup globalnom stanju aplikacije.
U poglavlju \ref{section:mrezna-komunikacija} je
konkretno objašnjeno gdje se, u ovom kontekstu, globalno stanje koristi.
Prije registracije nove rute potrebno je kreirati i konfigurirati socketioxide uslugu koja
se može proslijediti u rutu. 
Usluga ima postavljeno na šezdeset sekundi vremena čekanja za \texttt{ping} i \texttt{ack}
događanja. Ovo su posebna događanja koja socketioxide koristi za provjeru veze s klijentom
i uspješno dostavljenih poruka/događaja.
Poslužitelj u nekom intervalu šalje ping događaj klijentu te klijent ima šezdeset
sekundi za poslati pong odgovor, u suprotnom veza s klijentom bude isključena.
Na sličan način funkcionira ack događaj, kod ovog događaja klijent ima određeno vrijeme
za slanje odgovora primitka nekog događaja od poslužitelja. 
Ovim mehanizmima socket.io garantira da su klijenti aktivni te ako nisu može isključiti
vezu s njima i obustaviti slanje događaja prema neaktivnim klijentima.

\texttt{io.ns("/", on\_connect::<T>);} definira da će se pozvati \texttt{on\_connect} funkcija
kad se klijent spoji na namespace \texttt{/}. Socket.io koristi namespace kao jedan od načina
za grupiranje povezanih klijenata i odabir klijenata kojima će se slati događaji. Drugi način su
sobe, poslužitelj odlučuje ako i u koju sobu će pridružiti klijenta. Sobe su koncept jedino
dostupan poslužitelju, klijenti nemaju pristup popisu soba kojima su pridruženi.
Spajanjem klijenta poziva se funkcija \texttt{on\_connect} koja služi da se povezanom klijentu
registrira povratni poziv funkcije u slučaju ako se klijent isključi te postavlja vezu u
određeno stanje. Drugi registrirani povratni poziv funkcije se koristi za povezivanje klijenta
u određenu sobu i slanje podataka o igri tom klijentu te povezivanje tog klijenta s 
drugima u istoj sobi. Sve dok klijent ne pošalje odgovarajući \texttt{JOIN\_EVENT} događaj
neće primati nikakve događaje od poslužitelja, ni poslužitelj neće primati nikakve druge
događaje od klijenta. Više o povezivanju između klijenata i poslužitelja u poglavlju \ref{section:mrezna-komunikacija}.

\begin{minted}[samepage]{rust}
pub fn get_router<T: AppStateTrait>(state: T) -> axum::Router {
    let (service, io) = SocketIoBuilder::new()
        .with_state(state.clone())
        .ping_timeout(Duration::from_secs(60))
        .ack_timeout(Duration::from_secs(60))
        .connect_timeout(Duration::from_secs(60))
        .build_svc();

    io.ns("/", on_connect::<T>.with(auth_middleware::<T>));

    axum::Router::new().route_service(
        "/socket.io/",
        ServiceBuilder::new()
            .layer(CorsLayer::permissive())
            .service(service),
    )
}

pub fn on_connect<T: AppStateTrait>(socket: SocketRef) {
    let socket_clone = socket.clone();
    socket.on_disconnect(move |reason: DisconnectReason| {
        socket_clone.extensions.remove::<JoinedFlag>();
    });

    socket.on(JOIN_EVENT, join_handler::<T>);
}

\end{minted}
\begin{figure}[H]
\centering
\captionof{listing}{Postavljanje socketioxide poslužitelja kao axum rutu}
\label{lst:postavljanje-socketioxide-poslužitelja-kao-axum-rutu}
\end{figure}

\subsection{Baza podataka}
\label{section:baza-podataka}

Baze podataka koriste se u aplikacijama kako bi osigurale pouzdan, trajan i strukturiran
način pohrane informacija. Omogućuju organiziranje podataka u tablice i relacije, što olakšava
upravljanje složenim skupovima podataka. Osim pohrane, baze podataka ključne su za
očuvanje integriteta podataka putem transakcija, koje osiguravaju da podaci ostanu
dosljedni čak i u slučaju kvarova sustava. Također omogućavaju aplikacijama pretraživanje
i dohvaćanje specifičnih informacija putem upitnih jezika poput SQL-a \cite{kreibich2010using}.

U aplikaciji se koristi SQLite za pohranu podataka. SQLite je odabran zbog jednostavnosti
direktnog ugrađivanja baze podataka u aplikaciju. Za razliku od tradicionalnih baza podataka,
poput PostgreSQL-a, koji koriste klijent-poslužitelj arhitekturu i zahtjevaju zaseban poslužiteljski
proces za upravljanje podacima i zahtjevima. SQLite integrira cijeli mehanizam baze podataka izravno
u aplikaciju. SQLite cijelu bazu podataka pohranjuje u jednu datoteku \cite{kreibich2010using}.

Bez posebne konfiguracije SQLite nije najbolje namijenjen za istovremeno pisanje i čitanje podataka.
Zato su u slijedećem isječku koda prikazane korištene postavke za SQLite vezu, kako bi se poboljšale
performanse kod istovremenog pisanja i čitanja za više klijenata.
\texttt{journal\_mode} je postavljena na \texttt{WAL} kako bi se omogućilo istovremeno čitanje i pisanje.
Opcija \texttt{synchronous} je postavljena na \texttt{NORMAL} kako bi se izbjegao gubitak podataka u
slučaju da se dogodi neka greška pri pisanju podataka iz write ahead log-a (WAL-a) u bazu.
Opcija \texttt{busy\_timeout} ima vrijednost od pet sekundi te omogućava bazi
da pričeka određeno vrijeme prije vraćanja greške u slučaju da pokušava zapisivati u 
redove zaključane drugom transakcijom. Opcija \texttt{cache\_size} povećava veličinu predmemorije
i smanjuje broj zapisa koji će se raditi na disk. Opcija \texttt{foreign\_keys} uključuje provjeru 
stranih ključeva na tablicama, bez ove opcije SQLite ne provjerava ako tablica ima relaciju na
neku drugu tablicu, ni ako je ta relacija validna.
Postavljanjem \texttt{auto\_vacuum} na \texttt{INCREMENTAL} omogućuje postepeno oslobađanje 
prostora na disku kako se retci iz baze brišu, umjesto potpunog oslobađanja tijekom
nekih od operacija nad bazom. Postavljanjem \texttt{temp\_store} na \texttt{MEMORY}
SQLite će privremene tablice pohraniti u memoriji umjesto spremati ih na disk i kasnije
odbaciti \cite{sqlitedefaults}.

\begin{minted}[samepage]{rust}
let pool = db.get_sqlite_connection_pool().clone();

let connect_options = (*pool.connect_options())
    .clone()
    .journal_mode(sqlx::sqlite::SqliteJournalMode::Wal)
    .synchronous(sqlx::sqlite::SqliteSynchronous::Normal)
    .busy_timeout(std::time::Duration::from_secs(5))
    .pragma("cache_size", "-20000")
    .foreign_keys(true)
    .auto_vacuum(sqlx::sqlite::SqliteAutoVacuum::Incremental)
    .pragma("temp_store", "MEMORY");
pool.set_connect_options(connect_options);
\end{minted}
\begin{figure}[H]
\centering
\captionof{listing}{Postavljene SQLite opcije}
\label{lst:postavljene-sqlite-opcije}
\end{figure}

Na slijedećoj slici je prikaz svih tablica i relacija u bazi podataka.
Baza se sastoji od tablica \texttt{assets}, \texttt{thumbnails}, \texttt{game} i \texttt{entity}.
Tablica \texttt{assets} definira datoteku učitanu na poslužitelja, ima nekoliko stupaca koji
opisuju naziv, vrstu datoteke, originalni naziv datoteke. \texttt{Thumbnails} tablica
ima relaciju na \texttt{assets} tablicu, jedan red u \textttt{thumbnails} tablici predstavlja 
sličicu koja je generirana za originalnu učitanu sliku.
Tablica \texttt{game} samo zadrži naziv igre i sustav koji igra koristi, dok \texttt{entity}
tablica sadrži sve entitete vezane za neku igru i sve njihove podatke. Podaci i vrsta entiteta
definirana je od strane klijenta tj. implementacije igre, jednako tako klijent je odgovoran za
spremanje id-a asset-a u neki od podataka u entitetu, poslužitelj nema način za pregled svih
asset-a i provjeru kojoj igri pripadaju.



\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{slike/db_scheme.png}
    \caption{Shema baze podataka [autorski rad]}
    \label{fig:shema-baze-podataka}
\end{figure}

\subsection{API krajnje točke}
\label{section:endpoints}

U tablici ispod su definirane sve krajnje točke kojima klijenti imaju pristup i na
koje poslužitelj odgovara. Većina komunikacije između poslužitelja i klijenta odvija se
kroz websocket. Može se primijetiti da u popisu fali krajnja točka za
pridruživanje igri, fali iz razloga što se pridruživanje izvršava kroz websocket
te ima nekoliko koraka koje klijent mora odraditi da bi se uspješno pridružio igri.
Više o načinu pridruživanja u poglavlju \ref{section:mrezna-komunikacija}.

\begin{table}[H]
    \centering
    \caption{API krajnje točke [autorski rad]}
    \begin{tabularx}{1\linewidth}{|X|c|X|}
        \hline
        \textbf{Ruta} & \textbf{HTTP Metoda} & \textbf{Opis} \\ \hline
        /public/\{path\} & GET & Omogućava dohvaćanje datoteka koji su dostupni javnosti, 
        na primjer ikonica ili css stilova \\ \hline
        /socket.io/ & GET & Služi za povezivanje socket.io klijenata \\ \hline
        /assets/upload & POST & Omogućuje učitavanje datoteka na poslužitelj.
        Poslužitelj odgovara s id-em datoteke linkovima i id-evima sličica ukoliko
        je učitana datoteka slika \\ \hline
        /assets/thumbnails/\{image\_id\} & GET & Dohvaća sličicu definiranu parametrom \texttt{image\_id} \\ \hline
        /assets/\{filename\} & GET & Dohvaća dokument definiran parametrom \texttt{filename} \\ \hline
        /game/list & GET & U \texttt{JSON} formatu šalje popis svih dostupnih sesija igre \\ \hline
        /game/create & POST & Kreira novu sesiju igre \\ \hline
    \end{tabularx}
    \\[10pt]
    \label{tab:api-krajnje-tocke}
\end{table}

\subsection{Mrežna komunikacija}
\label{section:mrezna-komunikacija}

Mrežna komunikacija između klijenta i poslužitelja se odvija na dva načina.
Prvi je kroz API krajnje točke, definirane u poglavlju \ref{section:endpoints},
drugi je kroz websocket koristeći socket.io. 
U isječku koda \ref{lst:postavljanje-socketioxide-poslužitelja-kao-axum-rutu} 
je vidljivo korištenje funkcije \texttt{.with(auth:middleware::<T>)}, da bi se klijent
uspješno povezao na websocket mora poslati određeni sadržaj pri povezivanju na \texttt{/socket.io/}
krajnju točku. Sadržaj koji klijent mora poslati je \texttt{id} igre u koju se želi pridružiti.
Poslužitelj će tada obaviti autentifikaciju i korištenjem \texttt{socket.extension.insert(auth);}
zapisati podatke na instancu websocketa kako bi se podaci mogli kasnije koristiti te da bi poslužitelj
imao uvid u koju igru je klijent pridružen.

\begin{minted}[samepage]{rust}
fn auth_middleware<T: AppStateTrait>(
    socket: SocketRef,
    State(app_state): State<T>,
    Data(auth): Data<WebsocketAuthMessage>,
) -> Result<(), websocket_auth::Error> {
    match auth.authenticate(&app_state) {
        Ok(()) => {
            socket.extensions.insert(auth);
            Ok(())
        }
        Err(e) => Err(e),
    }
}
\end{minted}
\begin{figure}[H]
\centering
\captionof{listing}{Autentifikacije websocket klijenta}
\label{lst:autentifikacija-websocket-klijenta}
\end{figure}

U poglavlju \ref{section:socketioxie}
je definirano da će poslužitelj, nakon uspješnog spajanja klijenta, samo reagirati
na događaj odspajanja klijenta s veze i događaj \texttt{JOIN\_EVENT}.
Kad je klijent spreman može poslati \texttt{JOIN\_EVENT} događaj na poslužitelj.
Poslužitelj će u trenutku primitka ovog događaja početi proceduru za pridruživanje klijenta u igru.
U isječku koda \ref{lst:procedura-za-pridruzivanje} je vidljiva cijela procedura pridruživanja klijenta
u igru, započinje s čitanjem id-a igre kojoj se klijent pridružuje. Podatak je isčitan s websocket 
instance koja je u trenutnu autentifikacije imala postavljene podatke o igri.
Nakon toga poslužitelj pridružuje websocket u sobu. Sobe se koriste za slanje podataka između klijenata
koji su povezani u istu igru. Također odmah nakon pridruživanja sobe, poslužitelj registrira
slušatelja za događaj \texttt{ACTION} na websocket.
U isječku je vidljivo ponovno korištenje \texttt{AppStateTrait} globalnog stanja za dohvaćanje reda 
čekanja entiteta i pokretanje transakcije u bazi podataka.
Red čekanja je korišten za periodično spremanje entiteta u bazu podataka te se kod svakog pridruživanja
dohvaća i sprema u bazu kako bi kod dohvaćanja entiteta svi bili zapisani u bazi podataka.
Nakon dohvaćanja svih entiteta iz baze, poslužitelj u manjim dijelovima šalje događaje \texttt{JOIN\_EVENT}
klijentu s podacima o entitetima i stanju slanja. Klijent je odgovoran za pretvaranje entiteta u objekte
koje razumije i može koristiti tokom igre.
Po završetku slanja entiteta poslužitelj šalje klijentu događaj \texttt{JOIN\_FINISHED\_EVENT} što
označava da su svi entiteti uspješno poslani te klijent ima sve podatke za pridruživanje i sinkronizaciju
igre.

\begin{minted}[samepage]{rust}
#[tracing::instrument(skip(socket, app_state))]
async fn join_handler<T: AppStateTrait>(
    socket: SocketRef,
    State(app_state): State<T>,
    Extension(auth): Extension<WebsocketAuthMessage>,
) {
    let game_id = auth.game;
    let room = format!("room-{game_id}");

    socket.join(room);
    socket.on(ACTION, action_handler::<T>);

    let queue = app_state.get_entity_queue();
    {
        let mut lock = queue.lock().await;
        if let Some(handle) = lock.flush().await { handle.await.ok(); }
    }

    tracing::debug!("Starting database entity fetch");
    let db = app_state.get_db();
    let transaction = db.begin().await?;

    let entity_manager = EntityManager::new();

    let entities = entity_manager.load_entities(&transaction, game_id).await?;

    let total = entities.len();
    let mut sent = 0;
    tracing::debug!("Sending entities in {} chunks", total / CHUNK_SIZE);
    entities.chunks(CHUNK_SIZE).for_each(|chunk| {
        sent += chunk.len();
        socket
            .emit(JOIN_EVENT, &serde_json::json!({
                    "progress": {
                        "sent": sent,
                        "total": total
                    },
                    "data": chunk
                }),
            )
            .ok();
    });

    socket.emit(JOIN_FINISHED_EVENT, &()).ok();
}
\end{minted}
\begin{figure}[H]
\centering
\captionof{listing}{Procedura za pridruživanje}
\label{lst:procedura-za-pridruzivanje}
\end{figure}

Pridruženi klijenti komuniciraju kroz poslužitelja slanjem događaja \texttt{ACTION}.
Svi validni \texttt{ACTION} događaji će biti proslijeđeni do klijenata.
Na slici ispod je prikazan primjer razmjene poruka između klijenata i poslužitelja.
Na poslužitelja su spojena četri klijenta, klijent 1, 2 i 4 su spojeni u sobu \texttt{room-1}
dok je klijent 3 spojen u sobu \texttt{room-2}. Klijent 1 pošalje validni događaj prema poslužitelju,
poslužitelj će taj događaj procesirati te proslijediti događaj ostalim klijentima.
Poslužitelj odabire primatelje prema sobi kojoj pripada pošiljatelj događaja, pošto u ovom primjeru
pošiljatelj (Klijent 1) pripada u sobu \texttt{room-1}, događaj je proslijeđen klijentima 2 i 4,
dok klijent 3 nema uvid da se uopće dogodila bilo kakva razmjena informacija i ne dobiva nikakav događaj.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{slike/razmejna_podataka_izmedu_klijenata.png}
    \caption{Komunikacija između klijenata [autorski rad]}
    \label{fig:mrežna-komunikacija-izmedu-klijenata}
\end{figure}

Isječak koda ispod prikazuje strukturu poruke koja je očekivana.
Klijent poruku mora poslati u JSON formatu te poruka mora imati definiranu strukturu.
Mora sadržavati polja \texttt{action} i \texttt{data}. Polje \texttt{action} definira vrstu
akcije, postoji nekoliko definiranih vrsta \texttt{Update}, \texttt{Create}, \texttt{Delete},
\texttt{Transitive} i \texttt{Other}. 

Vrste \texttt{Update}, \texttt{Create}, \texttt{Delete}
osim što klijentima označavaju da se neki entitet promijenio, poslužitelju daju do znanja
da je za entitete u \texttt{data} polju potrebno izvršiti određenu radnju, bilo to kreirati ih i 
spremiti u bazu podataka, ažurirati postojeće vrijednosti ili izbrisati entitete.
Zadnje dvije vrste \texttt{Transitive} i \texttt{Other} su vrste poruka koje su uvijek poslane
samo do drugih klijenata, a poslužitelj ne radi dodatno procesiranje ovih poruka. 
\texttt{Transitive} je namijenjen porukama koje nemaju potrebe za poslužiteljom i ne ažuriraju
podatke vezane uz igru, na primjer jedan klijent može poslati poruku da se drugom klijentu na
ekranu otvori novi prozor. \texttt{Other} je vrlo slična vrsta \texttt{Transitive} s razlikom da
klijent na ovu vrstu poruke ima mogućnost pridodati proizvoljne podatke te ti podaci ne podliježu
nekoj određenoj strukturi, definirani su samo kod klijenta.

Funkcija polja \texttt{data} je slanje podataka o entitetima nad kojima se vrši neka radnja.
Cijela struktura jednog entiteta definirana je od strane klijenta, no poslužitelj treba nekoliko
podataka o entitetu kako bi ga mogao pohranjivati te sinkronizirati podatke između klijenata.
Entiteti su definirani kroz nekoliko polja \texttt{uid}, \texttt{kind}, \texttt{timestamp} i
\texttt{other\_values}. Polje \texttt{other\_values} služi kao rezervirano mjesto za bilo kakve
dodatne podatke vezane uz entitet. Polje \texttt{uid} definira jedinstveni identifikator entiteta.
Odgovornost je klijenta da sve identifikatore zadrži jedinstvenima. \texttt{Kind} služi
kako bi klijent mogao razlikovati između različitih vrsta entiteta koje kreira.
U poglavlju \ref{section:klijent} je objašnjen način pretvaranja entiteta iz JSON
formata u entitet objekt koji igra može koristiti.
Zadnje definirano polje je \texttt{timestamp}, koje služi za sinkronizaciju podataka.
Mrežna komunikacija je bazirana na mreži ravnopravnih čvorova te svaki klijent
ima odgovornost postaviti \texttt{timestamp} na vrijeme u milisekundama kad je
zadnje napravljena neka promjena na entitetu. Poslužitelj koristi \texttt{timestamp} za
identifikaciju promjena na entitetima i odlučivanja koje promjene su ažurne, a koje
može odbaciti.

\begin{minted}[samepage]{rust}
#[derive(Debug, Clone, Serialize, Deserialize, PartialEq, Eq)]
#[serde(rename_all = "kebab-case")]
pub enum Action {
    Update,
    Create,
    Delete,
    Transitive,
    Other(serde_json::Value),
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct ClientsideEntity {
    pub uid: UId,
    pub kind: EntityKind,
    pub timestamp: UtcTimestamp,
    #[serde(flatten)]
    pub other_values: serde_json::Value,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct ActionMessage {
    action: Action,
    data: Vec<ClientsideEntity>,
}
\end{minted}
\begin{figure}[H]
\centering
\captionof{listing}{Struktura Action poruke}
\label{lst:struktura-action-poruke}
\end{figure}

\section{Klijent}
\label{section:klijent}

Klijent je drugi glavni dio cijele aplikacije. 
Pruža korisnicima korisničko sučelje za pračenje bitke na više različitih scena
te uvid u trenutna događanja u igri.
Implementiran je korištenjem web tehnologija i pokreće se u web pregledniku kroz web
stranicu ili kroz tauri okvir kao zasebna desktop aplikacija.

\subsection{Pixi.js}
\label{section:pixijs}

Pixi.js je biblioteka za 2D renderiranje izgrađena na WebGL i WebGPU tehnologijama.
Omogućava razvijanje grafičkih aplikacija na web-u te je pogodna za izradu igara,
interaktivnih oglasa, edukacijskih materijala i vizualizaciju podataka \cite{pixijs}.
U aplikaciji se pixi.js koristi za prikaz različitih scena s poljima, pozadinskim grafikama,
likovima, vizualizaciju poteza te bilo kakvih drugih grafičkih elemenata.

Arhitektura pixi.js je podijeljena u nekoliko glavnih komponenata \cite{pixijs-architecture}:
\begin{itemize}
    \item Komponenta za renderiranje: prikazuje i crta scenski graf na ekran.
    \item Kontejneri: Glavni objekti na sceni kroz koje se kreira scenski graf tj.
        stablo objekata koji se mogu prikazati, objekti kao što su tekst, spriteovi i druga grafika.
    \item Slikovno/zvučni elementi: sustav za asinkrono učitavanje i dekodiranje resursa poput 
        slikovnih i zvučnih datoteka.
    \item Ticker: periodični povratni pozivi na temeljeni na vremenskom intervalu.
        Korisni za ažuriranje podataka, grafike ovisno o vremenu ili nekoj
        promjeni podataka kroz vrijeme.
    \item Događanja: interaktivnost kontejner objekata kroz emitiranje i reagiranje na
        događaje, npr. klik na objekt ili prolaz pokazivača miša preko objekta.
\end{itemize}

Kombinacijom glavnih komponenata moguće je implementirati sve dijelove potrebne za aplikaciju.
Na primjer, u aplikaciji se kontejneri koriste za prikaz scena i crtanje polja na ekran,
slikovno/zvučni elementi za učitavanja slika i postavljanje slika u kontejnere, ticker za periodično
crtanje obruba oko kontejnera te postepenu promjenu boje obruba, događanja su korištena i omogućavaju korisniku
premještanje pozicije kontejnera i promjenu veličine određenih kontejnera. 
Više detalja o implementaciji i korištenju svakih od navedenih elemenata u poglavlju \ref{section:sustav-scena}.

\subsection{React.js}
\label{section:reactjs}

React je javascript biblioteka namijenjena za izgradnju korisničkih sučelja u web aplikacijama \cite{reactjs}.
Najčešće korištena za aplikacije s jednom stranicom, ovakve aplikacije uglavnom koriste 
različite implementacije usmjerivača kako bi jedna web stranica imala više različitih stranica.
Arhitektura react-a je temeljena na komponentama, one su neovisni, ponovno upotrebljivi građevni
blokovi korisničkog sučelja. Komponente upravljaju vlastitim internim podacima te promjenom podataka u komponenti
će react ponovno prikazati komponentu s novim podacima, na ovakav način react omogućuje ažurno korisničko
sučelje \cite{reactjs}.

Pošto je react samo biblioteka za izradu korisničkih sučelja, ne grupira i ne dolazi s unaprijed kreiranim komponentama.
Kako bi izbjegli potrebu za kreiranjem svake komponente, na primjer jednostavne tipke ili prozora za odabir više elemenata,
aplikacija koristi biblioteku mantine. Mantine je biblioteka koja implementira veliki broj react komponenata i pruža
unaprijed stilizirane i funkcionalne komponente koje se mogu dodatno prilagođavati.

Još jedna biblioteka koja se koristi u aplikaciji je jotai. 
Jotai je biblioteka za atomski pristup i upravljanje globalnim varijablama react stanja.
Globalno stanje se izrađuje kroz kombinaciju atoma i promjene te potrebni prikazi promjena
su optimizirani na temelju ovisnosti o atomu. Ovakav pristup rješava problem ponovnog i nepotrebnog
renderiranje react konteksta, smanjuje ili eliminira potrebu za memoizacijom \cite{jotai}.
U aplikaciji je jotai uglavnom korišten za usklađivanje promjena između korisničkog sučelja i
pixi.js konteksta, tj. objekata koje pixi.js renderira.

\subsection{Socket.io}
\label{section:socket-io-klijent}

\subsection{Entiteti}
\label{section:entiteti}

\subsection{Sustav scena}
\label{section:sustav-scena}
\section{Primjer borbe}
\label{section:primjer-borbe}

Ovo je glavni dio rada u kojem treba razraditi temu, pojasniti istraživanja, prikazati rezultate i slično. Poželjno je na početku poglavlja dati kratki opis strukture poglavlja, kako bi čitatelj/čitateljica rada mogao/mogla lakše pratiti složenu cjelinu.

\section{Poglavlje druge razine}

\subsection{Poglavlje treće razine}

\subsubsection{Poglavlje četvrte razine}

\chapter{Prikaz slučajeva korištenja}

Tehničke upute u nastavku opisuju način tehničkog oblikovanja rada i navođenja literature.

\section{Upute za oblikovanje izgleda rada}

\begin{flushleft}\textbf{Stranice} se oblikuju korištenjem sljedećih parametara:\end{flushleft}

\begin{itemize}
    \item veličina i oblik papira je A4, okomito usmjerenje, margine 2,5 cm na svakoj strani;

    \item naslovna stranica rada se ne numerira;

    \item nakon naslovne stranice, sve sljedeće stranice do 1. Poglavlja se numeriraju rimskim brojevima, počevši od i;

    \item od 1. poglavlja nadalje, stranice se numeriraju arapskim brojevima;

    \item broj stranice treba pozicionirati desno 1,25 cm od dna stranice, font Arial 9.
\end{itemize}
\begin{flushleft}\textbf{Tekst} rada je potrebno oblikovati sukladno ovom predlošku, odnosno na sljedeći način:\end{flushleft}
\begin{itemize}
    \item u pisanju teksta koristite font Arial 11 pt, s proredom 1,5 te razmakom 0 pt prije i razmakom 6 pt poslije odlomka, pri čemu je prvi redak uvučen za 1,25 cm;

    \item u naslovima prve razine „3. Razrada teme“ koristite font Arial 18 pt, podebljano, prijelom stranice (svaki naslov prve razine treba biti na novoj stranici), s proredom 1,5 te razmakom 0 pt prije i razmakom 18 pt poslije odlomka;

    \item u naslovima druge razine „2.1. Naslov“ koristite font Arial 16 pt, podebljano, s proredom 1,5 te razmakom 18 pt prije i razmakom 12 pt poslije odlomka;

    \item u naslovima treće razine „2.1.1. Naslov“ koristite font Arial 14 pt, podebljano, s proredom 1,5 te razmakom 12 pt prije i razmakom 6 pt poslije odlomka;

    \item u naslovima četvrte razine „2.1.1.1. Naslov“ koristite font Arial 12 pt, podebljano, s proredom 1,5 te razmakom 6 pt prije i razmakom 6 pt poslije odlomka;

    \item ostalo značajno isticanje cjelina rada može biti istaknuto podebljanim i kurziv slovima, korištenjem fonta Arial 11 pt.
\end{itemize}


\begin{flushleft}\textbf{Slike} u radu je potrebno oblikovati na sljedeći način:
naziv slike navedite ispod slike uz numeraciju;\end{flushleft}

\begin{itemize}
    \item za nazive slika koristite iste postavke fonta kao i za tekst, ali stavite naziv slike u centrirani položaj;

    \item za oblikovanje same slike koristite font Arial 9 pt za tekst na slici;
ispred same slike umetnite jedan prazan redak (osim ako je slika pozicionirana na početku stranice);

    \item nakon naziva slike ostavite jedan redak prazan (osim ako je naziv slike zadnji redak na stranici);

    \item kod prijeloma stranice treba obratiti posebnu pozornost da naziv slike, izvor i sama slika moraju biti na istoj stranici; 

    \item slike je potrebno numerirati redom pojavljivanja u tekstu;

    \item ako je slika preuzeta iz drugog izvora, nakon navođenja naziva slike u zagradi navedite izvor, npr. (autor/autorica, godina);

    \item dozvoljeno je napraviti vlastitu preradu slika, grafikona ili tablica na način da se zadrži isti smisao sadržaja, ali promijeni izgled. I u takvim se slučajevima obavezno u nazivu navodi referenca izvornog djela ovako: “(Prema: Klačmer Čalopa i Cingula, 2012)“;

    \item dozvoljeno je preuzeti samo jednu sliku, grafikon ili tablicu u izvornom obliku iz istog izvora. Za doslovno preuzimanje većeg dijela sadržaja potrebno je ishoditi dozvolu nositelja autorskih prava;

    \item primjer označavanja slike možete vidjeti u nastavku (slika \ref{fig:podjela}).
\end{itemize}

\begin{figure}[h!]
    \centering
    \includegraphics[width=0.9\textwidth]{slike/slika.png}
    \caption{Podjela investicijskih fondova (Izvor: \citeauthor{Aranda2009}, \citeyear{Aranda2009})}
    \label{fig:podjela}
\end{figure}

\begin{flushleft}\textbf{Tablice} rada je potrebno oblikovati sukladno ovim uputama:\end{flushleft}
\begin{itemize}
    \item naziv tablice navedite iznad slike;

    \item za nazive tablica koristite iste postavke fonta kao i za tekst, ali stavite naziv tablice u centrirani položaj;

    \item za oblikovanje same tablice koristite font Arial 9 pt za tekst u tablici;

    \item tablice numerirajte redom pojavljivanja u tekstu;

    \item prije naziva tablice umetnite jedan redak prazan (osim ako je naziv tablice prvi redak na stranici);

    \item nakon same tablice umetnite jedan prazan redak (osim ako je tablica pozicionirana na kraju stranice);

    \item kod prijeloma stranice treba obratiti posebnu pozornost da naziv tablice, izvor i sama tablica moraju biti na istoj stranici; 

    \item ako je tablica preuzeta iz drugog izvora, nakon navođenja naziva tablice potrebno je navesti izvor, na isti način kako je opisano kod slika;

    \item primjer označavanja tablice možete vidjeti u nastavku (tablica \ref{tab:objekti}).
\end{itemize}

\begin{table}[h!] 
    \centering
    \caption{Prikaz podataka o učestalosti pojavljivanja objekta}
    \begin{tabularx}{0.66\textwidth}{|X|X|X|X|}
        \hline
         \cellcolor{gray!25} & \cellcolor{gray!25} & \cellcolor{gray!25} & \cellcolor{gray!25} \\
        \hline
         &  &  &  \\
        \hline
         &  &  & \\
        \hline
    \end{tabularx}
    \\[10pt]
    \caption*{(Izvor: \citeauthor{caragliu2011smart}, \citeyear{caragliu2011smart})}
    \label{tab:objekti}
\end{table}

\begin{flushleft}\textbf{Programski kod}\end{flushleft}
\begin{itemize}
    \item za oblikovanje teksta koji je programski kôd koristite font Courier, veličine 10 pt, jednostruki prored, 6 pt iza odlomka, npr. HTML kôd dijela zaglavlja početne web stranice FOI weba:
\end{itemize}

\begin{lstlisting}[language=HTML]
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="shortcut icon" href="https://www.foi.unizg.hr/sites/default/files/favicon_0_1.ico" type="image/vnd.microsoft.icon" />
  <meta name="generator" content="Drupal 7 (http://drupal.org)" />
  <link rel="canonical" href="https://www.foi.unizg.hr/hr" />
  <link rel="shortlink" href="https://www.foi.unizg.hr/hr" />
  <!-- Set the viewport width to device width for mobile -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dobro %*došli*) na FOI | FOI</title>...
</head>
\end{lstlisting}

\begin{flushleft}\textbf{Formule}\end{flushleft}
\begin{itemize}
    \item za unos formula koristite editor za formule u svom tekst procesoru.
\end{itemize}

\begin{flushleft}\textbf{Kratice}\end{flushleft}   
\begin{itemize}
    \item ako želite koristiti kratice pojmova u tekstu, kad prvi put spominjete pojam potrebno je navesti puni naziv, a kraticu navesti u zagradi (npr. Informacijske i komunikacijske tehnologije, kraće IKT). Nakon toga možete koristiti kratice u tekstu. Poželjno je u naslovima koristiti pune nazive.
\end{itemize}

\begin{flushleft}\textbf{Strano nazivlje}\end{flushleft}   
\begin{itemize}
    \item strano nazivlje se u tekstu navodi u zagradi, napisano \textit{kurzivom}, nakon hrvatskog izraza, npr. Analiza društvene mreže (engl. \textit{Social Network Analysis - SNA}).
\end{itemize}

\section{Navođenje literature}

Za navođenje literature u radu možete odabrati i koristiti jedan od sljedeća dva ponuđena stila: \textbf{APA} ili \textbf{IEEE} stil. Važno je samo dosljedno primjenjivati odabrani stil u cijelom radu.

U popisu literature potrebno je navesti svu literaturu i samo literaturu koju ste koristili u tekstu.

Uz svaku preuzetu tvrdnju potrebno je navesti njezin izvor, tj. referencu. Reference se u tekstu navode tako da se uz citirani tekst navede izvor, sukladno načinu propisanom odabranim stilom i FOI preporukama za citiranje i referenciranje \cite{SchattenEtAl2016roadmap}.

\chapter{Zaključak}

Ovdje treba sažeto rezimirati najvažnije rezultate razrade teme rada. Potrebno je sažeto opisati što je predmet rada, koje su metode, tehnike, programski alati ili aplikacije korištene u razradi rada te koje su pretpostavke dokazane, a koje opovrgnute. Sadržajno, ono što se u uvodu rada najavljuje i kasnije je obuhvaćeno u samom radu, moralo bi biti opisano u zaključnom dijelu kroz rezultate rada. 

\lipsum[1-2]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%  BIBLIOGRAPHY  %%%%%%%%%%%%%%
%%%%%%%%%%%  BIBLIOGRAPHY  %%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\printbibliography[title=Popis literature]
\addcontentsline{toc}{chapter}{Popis literature}

\listoffigures
\addcontentsline{toc}{chapter}{Popis slika}
 
\listoftables
\addcontentsline{toc}{chapter}{Popis popis tablica}

\appendix
\renewcommand{\thechapter}{\arabic{chapter}}

\end{document}
